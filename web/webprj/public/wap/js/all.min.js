angular.module("cftApp",["ionic","cftApp.storageFactory","ctfApp.keyboardHandler","cftApp.tabs","cftApp.factories","cftApp.slideBox","ctfApp.searchBar","cftApp.homePage","cftApp.integralStore","cftApp.napaStores","cftApp.personal","cftApp.goodsDetail","cftApp.collection","cftApp.myOrder","cftApp.receiptAddress","cftApp.shoppingCart","cftApp.totalScore","cftApp.payRecord","cftApp.integralGoodsDetail","cftApp.sortedGoods","cftApp.sortedIntegral","RongWebIMWidget","cftApp.confirmOrder","cftApp.evaluatePage","cftApp.scanCodePayment","myApp.codeExtend","myApp.aboutNapaStore"]).config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider","$locationProvider",function(e,o,t,a){t.platform.android.tabs.position("bottom"),t.tabs.position("bottom"),t.tabs.style("standard"),t.navBar.alignTitle("center"),t.scrolling.jsScrolling(!0),ionic.Platform.isFullScreen=!0,e.state("tabs",{url:"/tabs",abstract:!0,templateUrl:"tabs.html",controller:"tabsController"}),window.addEventListener("native.keyboardshow",function(){document.querySelector("div.tabs").style.display="none",angular.element(document.querySelector("ion-content.has-tabs")).css("bottom",0)}),window.addEventListener("native.keyboardhide",function(){var e=document.querySelectorAll("div.tabs");angular.element(e[0]).css("display","")}),a.hashPrefix("?"),o.otherwise("tabs/homePage")}]);var ROOT_URL="http://www.sunnyshu.cn/sunny/wap",perPageCount=10,user_car_num="",IconROOT_URL="http://www.sunnyshu.cn",SESSID="";angular.module("myApp.aboutNapaStore",[]).config(["$stateProvider",function(e){e.state("aboutNapaStore",{url:"/aboutNapaStore",templateUrl:"aboutNapaStore.html",controller:"aboutNapaStoreController"})}]).controller("aboutNapaStoreController",[function(){}]),angular.module("myApp.codeExtend",[]).config(["$stateProvider",function(e){e.state("codeExtend",{url:"/codeExtend",templateUrl:"codeExtend.html",controller:"codeExtendController"})}]).controller("codeExtendController",[function(){}]),angular.module("cftApp.collection",["ionic"]).config(["$stateProvider",function(e){e.state("tabs.collectionPager",{cache:!1,url:"/collectionPager",views:{"tabs-personal":{templateUrl:"collectionPager.html",controller:"collectionPagerController"}}})}]).controller("collectionPagerController",["$scope","$ionicModal","HttpFactory","$rootScope","$ionicPopup","$state","$ionicViewSwitcher","CftStore",function(e,o,t,a,s,r,n,i){function l(){!e.collect.isShowInfinite&&e.collect.collectionData.length>0&&(e.collect.noMoreData=1,e.collect.noMoreDataMsg="没有更多商品...")}function d(){e.collect.noMoreData=0,e.collect.noMoreDataMsg="",h=1,g("下拉"),e.$broadcast("scroll.refreshComplete"),e.collect.isShowInfinite=!0}function c(){h+=1,g("上拉")}function g(o){var a="/api/ucollection",s={page:h,sessid:SESSID};t.getData(a,s).then(function(t){return 10014==t.status?(e.popTipsShow(t.desc),window.history.back(),void(e.collect.isShowInfinite=!1)):(t.collectionData.length||(e.collect.emptyShopCarStr="您的收藏列表是空的O(∩_∩)O~"),"下拉"==o?(h+=1,e.collect.collectionData=t.collectionData):"上拉"==o&&0!=t.collectionData.length?e.collect.collectionData=e.collect.collectionData.concat(t.collectionData):0==t.collectionData.length&&(e.collect.isShowInfinite=!1),void(e.collect.collectionData.length<8?e.collect.isShowInfinite=!1:e.$broadcast("scroll.infiniteScrollComplete")))},function(o){e.collect.isShowInfinite=!1})}function p(o,a,r){s.show({cssClass:"myOrder",template:"确认要删除吗?",scope:e,buttons:[{text:"取消",onTap:function(e){var o=angular.element(document.querySelector(".backdrop"));o.removeClass("visible"),o.removeClass("active");var t=angular.element(document.querySelector(".myBody"));t.removeClass("popup-open"),e.stopPropagation()}},{text:"确定",onTap:function(o){var s=angular.element(document.querySelector(".backdrop"));s.removeClass("visible"),s.removeClass("active");var n=angular.element(document.querySelector(".myBody"));n.removeClass("popup-open"),o.stopPropagation();var i={id:a.id,sessid:SESSID};t.getData("/api/ucollection",i,"DELETE").then(function(o){0==o.status?(e.popTipsShow("删除成功"),e.collect.collectionData.splice(r,1)):e.popTipsShow("删除失败")},function(e){})}}]}),o.stopPropagation()}function u(){e.collect.val>1&&e.collect.val--}function m(){return e.goods_index.num<=0?void e.popTipsShow("抱歉,该商品没有库存了!"):void e.collect.val++}function f(o,t){t.stopPropagation(),r.go("tabs.confirmOrder_personal",{goodsArray:JSON.stringify([e.collect.collectionData[o]])})}function b(e,o){i.set("goodsName",o.title),0==o.is_integral?r.go("tabs.goodsDetail_collection",{is_integral:o.is_integral,goods_id:o.g_id,goods_icon:o.litpic}):r.go("tabs.igDetail_personal",{is_integral:o.is_integral,goods_id:o.g_id})}e.$on("$ionicView.beforeEnter",function(){a.hideTabs=!0}),e.collect={iconRootUrl:"",emptyShopCarStr:"",collectionData:[],deleteCollect:p,val:1,reduce:u,add:m,loadCollectionsData:g,doRefresh:d,loadMore:c,isShowInfinite:!0,goToExchangeNow:f,goToGoodsDetail:b,noMoreData:0,noMoreDataMsg:"",dragup:l};var h=0;e.collect.IconROOT_URL=IconROOT_URL,o.fromTemplateUrl("shopCarModal.html",{scope:e,animation:"slide-in-up"}).then(function(o){e.modal=o}),e.shopCardShow=function(o,t){t.stopPropagation(),e.modal.show(),e.goods_index=e.collect.collectionData[o],e.modal.IconRootURL=IconROOT_URL,e.modal.goodsData={goods_introduction:[e.collect.collectionData[o].litpic],goods_name:e.collect.collectionData[o].title,shop_price:e.collect.collectionData[o].price,goods_number:e.collect.collectionData[o].num}},e.$on("$destroy",function(){e.modal.remove()}),e.addToShoppingCar=function(){if(e.goods_index.num<=0)return void e.popTipsShow("抱歉,该商品没有库存了!");var o={goods_id:e.goods_index.g_id,num:e.collect.val,sessid:SESSID};t.getData("/api/ushoppingCart",o,"POST").then(function(o){0==o.status?(e.modal.hide(),user_car_num+=1,e.user_Car_Num+=user_car_num,e.popTipsShow("加入购物车成功")):e.popTipsShow("加入购物车失败")},function(e){})},e.goToConfirmOrder=function(){return e.modal.hide(),e.goods_index.num<=0?void e.popTipsShow("抱歉,该商品没有库存了!"):(e.goods_index.goodsNum=e.collect.val,void r.go("tabs.confirmOrder_personal",{goodsArray:JSON.stringify([e.goods_index])}))}}]),angular.module("cftApp.confirmOrder",[]).config(["$stateProvider",function(e){e.state("tabs.confirmOrder",{url:"/confirmOrder/:goodsArray",views:{"tabs-homePage":{templateUrl:"confirmOrder.html",controller:"confirmOderController"}}}).state("tabs.confirmOrder_IG",{url:"/confirmOrder_IG/:goodsArray",views:{"tabs-integralStore":{templateUrl:"confirmOrder.html",controller:"confirmOderController"}}}).state("tabs.confirmOrder_personal",{url:"/confirmOrder_personal/:goodsArray",views:{"tabs-personal":{templateUrl:"confirmOrder.html",controller:"confirmOderController"}}})}]).controller("confirmOderController",["$scope","$rootScope","$stateParams","HttpFactory","$state","$location","$ionicModal","CftStore","MainData",function(e,o,t,a,s,r,n,i,l){function d(){for(var o=0;o<e.confirmObj.goodsArray.length;o++)0==e.confirmObj.goodsArray[o].is_integral?e.confirmObj.goodsNum_all+=parseInt(e.confirmObj.goodsArray[o].goodsNum):e.confirmObj.goodsNum_all=1}function c(){for(var o=null,t=0;t<e.confirmObj.goodsArray.length;t++)if(0==e.confirmObj.goodsArray[t].is_integral){var a=e.confirmObj.goodsArray[t].shop_price?e.confirmObj.goodsArray[t].shop_price:e.confirmObj.goodsArray[t].price;o+=a*e.confirmObj.goodsArray[t].goodsNum}e.confirmObj.totalPrice=o}function g(){0==e.confirmObj.is_integral&&(r.path().indexOf("confirmOrder_personal")>-1?s.go("tabs.receiptAddress"):s.go("tabs.receiptAddress_home")),1==e.confirmObj.is_integral&&(r.path().indexOf("confirmOrder_personal")>-1?s.go("tabs.receiptAddress"):r.path().indexOf("confirmOrder_IG")>-1?s.go("tabs.receiptAddress_IG"):s.go("tabs.receiptAddress_home"))}function p(){if(e.confirmObj.goodsArray[0].goods_number<1)return void e.popTipsShow("库存不足");if(e.confirmObj.defaultAddress.id){if(!e.confirmObj.freight)return void e.popTipsShow("获取运费错误,购买失败!");console.log(e.confirmObj.goodsArray);var o={goods_id:JSON.stringify(b),collid:e.confirmObj.defaultAddress.id,mess:e.confirmObj.inputMsg,num:JSON.stringify(h),disPrice:e.confirmObj.freight,sessid:SESSID};console.log(o),e.loadingShow(),a.getData("/api/ordercode",o,"POST").then(function(o){console.log("**************************"),console.log(o),e.loadingOrPopTipsHide(),0==o.status?(o=o.parameters,e.confirmObj.oid=o.oid,wx.chooseWXPay({timestamp:o.timeStamp,nonceStr:o.nonceStr,package:o.package,signType:"MD5",paySign:o.paySign,success:function(o){"chooseWXPay:ok"==o.errMsg?(e.confirmObj.confirmOrderModalImg="images/confirmOrder.png",e.modal.show()):e.popTipsShow("支付出错!")}})):e.popTipsShow(o.desc)},function(o){e.popTipsShow("库存不足！")})}else e.popTipsShow("请先选择收货地址")}function u(){if(console.log(e.confirmObj.goodsArray[0]),e.confirmObj.goodsArray[0].goods_number<=1&&e.popTipsShow("库存不足！"),e.loadingShow(),e.confirmObj.defaultAddress.id){var o={goods_id:e.confirmObj.goodsArray[0].goods_id,collid:e.confirmObj.defaultAddress.id,mess:e.confirmObj.inputMsg,sessid:SESSID};a.getData("/api/integralOrder",o,"POST").then(function(o){0==o.status?(e.loadingOrPopTipsHide(),e.confirmObj.confirmOrderModalImg="images/confirmOrder_ig.png",e.confirmObj.oid=o.oid,e.modal.show()):e.popTipsShow(o.desc)},function(e){})}else e.popTipsShow("请先选择收货地址")}function m(){switch(i.set("inputMsg",e.confirmObj.inputMsg),e.modal.hide(),s.current.name){case"tabs.confirmOrder_IG":s.go("tabs.orderDetail_ig",{oid:e.confirmObj.oid});break;case"tabs.confirmOrder":s.go("tabs.orderDetail_home",{oid:e.confirmObj.oid});break;case"tabs.confirmOrder_personal":s.go("tabs.orderDetail",{oid:e.confirmObj.oid})}}l.userSelectAddress=null,"value传值"==t.goodsArray&&(console.log("value传值"),console.log(l.shopping_car_goodsArray),t.goodsArray=i.get("confirmGoodsArr")),e.$on("$ionicView.beforeLeave",function(){i.set("confirmGoodsArr","")}),e.confirmObj={inputMsg:"",is_integral:JSON.parse(t.goodsArray)[0].is_integral?JSON.parse(t.goodsArray)[0].is_integral:0,defaultAddress:{},hasDefaultAddress:!1,goodsArray:JSON.parse(t.goodsArray),goodsNum_all:null,IconROOTURL:IconROOT_URL,totalPrice:0,bottomTotalPrice:0,totalIngegralNum:JSON.parse(t.goodsArray)[0].price||JSON.parse(t.goodsArray)[0].integral,userIntegral:localStorage.getItem("creditNum"),goReceiptAddress:g,buyNow:p,convertNow:u,goToLookOrderDetail:m,confirmOrderModalImg:"images/confirmOrder_ig.png",oid:"",freight:0,isShow:!1};var f={};f["goods_id[]"]=[],f["num[]"]=[],angular.forEach(e.confirmObj.goodsArray,function(e){f["goods_id[]"].push(e.goods_id),f["num[]"].push(e.goodsNum)}),setTimeout(function(){0==e.confirmObj.is_integral&&a.getData("/api/getfsPrice",f).then(function(o){e.confirmObj.totalPrice=parseFloat(o.totalPrice.replace(/[^0-9-.]/g,"")),e.confirmObj.freight=parseFloat(o.disPrice),angular.forEach(e.confirmObj.goodsArray,function(t,a){e.confirmObj.goodsArray[a].price=o.goodsData[a].shop_price})},function(e){console.log(e)})},500),d(),c(),e.$on("$ionicView.beforeLeave",function(){document.querySelector(".myBackView")&&removeBackView()}),e.$on("$ionicView.beforeEnter",function(){o.hideTabs=!0;var t={sessid:SESSID};return a.getData("/api/memberInfo",t).then(function(o){0==o.status&&(e.confirmObj.userIntegral=o.integral,i.set("creditNum",o.integral))},function(e){}),l.userSelectAddress&&"continue"!=l.userSelectAddress?void("skip"==l.userSelectAddress||(e.confirmObj.hasDefaultAddress=!0,e.confirmObj.defaultAddress=l.userSelectAddress,e.confirmObj.defaultAddress.totalAddress=e.confirmObj.defaultAddress.province+e.confirmObj.defaultAddress.city+e.confirmObj.defaultAddress.address)):void setTimeout(function(){var o={success:function(o){0==o.status&&(1==o.addressData.length?(e.confirmObj.defaultAddress=o.addressData[0],e.confirmObj.defaultAddress.totalAddress=e.confirmObj.defaultAddress.province+e.confirmObj.defaultAddress.city+e.confirmObj.defaultAddress.address,e.confirmObj.hasDefaultAddress=!0):e.confirmObj.hasDefaultAddress=!1),e.$broadcast("scroll.refreshComplete")},error:function(e){}},t={page:1,sessid:SESSID,setdefault:1};a.getData("/api/uAddress",t,"GET").then(o.success,o.error)},300)});for(var b=[],h=[],O=0;O<e.confirmObj.goodsArray.length;O++)e.confirmObj.goodsArray[O].goods_id?b.push(e.confirmObj.goodsArray[O].goods_id):b.push(e.confirmObj.goodsArray[O].g_id),h.push(e.confirmObj.goodsArray[O].goodsNum);a.getData("/api/getAvgPrice",{sessid:SESSID,goods_id:JSON.stringify(b)}).then(function(o){0==o.status&&(e.confirmObj.freight=parseFloat(o.freight))}),n.fromTemplateUrl("confirmOrderModal.html",{scope:e,animation:"slide-in-enter"}).then(function(o){e.modal=o}),e.$on("$destroy",function(){e.modal.remove()})}]),angular.module("cftApp.evaluatePage",[]).config(["$stateProvider",function(e){e.state("tabs.evaluatePage",{url:"/evaluatePage",params:{goodsMsg:{}},views:{"tabs-personal":{templateUrl:"evaluatePage.html",controller:"evaluateController"}}})}]).controller("evaluateController",["$scope","$rootScope","$stateParams","HttpFactory","CftStore",function(e,o,t,a,s){function r(){i.goods_id=e.evaluateObj.goodsData[l].goods_id,i.oid=t.goodsMsg.ordercode,i.mess=e.evaluateObj.inputMsg[l],i.num=e.evaluateObj.goodsData[l].stars||5,a.getData("/api/assess",i,"POST").then(function(o){if(0==o.status){if(l++,l>=e.evaluateObj.goodsData.length)return e.popTipsShow(o.desc),e.$emit("detailEvaSucc","success"),void window.history.go(-1);r(l)}else e.$emit("detailEvaSucc","success"),e.popTipsShow(o.desc)},function(e){console.log(e)})}function n(e,o,t){t.stars=o+1,i.num=o+1;for(var a=angular.element(e.target).parent().children(),s=0;s<6;s++)s<=o?(angular.element(a[s]).removeClass("assess-grayStar"),angular.element(a[s]).addClass("assess-redStar")):(angular.element(a[s]).removeClass("assess-redStar"),angular.element(a[s]).addClass("assess-grayStar"))}e.$on("$ionicView.beforeEnter",function(){o.hideTabs=!0}),e.evaluateObj={selectedStar:n,goodsData:t.goodsMsg.goods_data,iconRootURL:"",assessSubmit:r,inputMsg:""};var i={goods_id:"",oid:"",num:"",mess:""},l=0;e.evaluateObj.iconRootURL=IconROOT_URL,e.graynums=[],e.graynums.length=5,e.goodsIcons=["img1"]}]),angular.module("cftApp.goodsDetail",[]).config(["$stateProvider",function(e){e.state("tabs.goodsDetail",{url:"/goodsDetail/:is_integral/:goods_id/:goods_icon",cache:!1,views:{"tabs-homePage":{templateUrl:"goodsDetail.html",controller:"goodsDetailController"}}}).state("tabs.goodsDetail_collection",{url:"/goodsDetail_collection/:is_integral/:goods_id/:goods_icon",cahce:!1,views:{"tabs-personal":{templateUrl:"goodsDetail.html",controller:"goodsDetailController"}}}).state("tabs.goodsDetail_orderDetail",{url:"/goodsDetail_orderDetail/:is_integral/:goods_id/:goods_icon",cahce:!1,views:{"tabs-personal":{templateUrl:"goodsDetail.html",controller:"goodsDetailController"}}})}]).controller("goodsDetailController",["$scope","$ionicScrollDelegate","$location","$stateParams","$state","$ionicViewSwitcher","$ionicModal","HttpFactory","$rootScope","$timeout","CftStore",function(e,o,t,a,s,r,n,i,l,d,c){function g(){e.goodsObj.moredata&&e.goodsObj.assessData.length>0&&(e.goodsObj.noneMsg="没有更多评论...")}function p(){w.page=j,i.getData("/api/assess",w).then(function(o){if(console.log(o),0==o.status){o.assessData.length<perPageCount?0==o.assessData.length&&0==e.goodsObj.assessData.length?(e.goodsObj.noneOfMoreData=!1,e.goodsObj.noneMsg="",e.goodsObj.dataIsNull=1):(e.goodsObj.dataIsNull=0,e.goodsObj.noneOfMoreData=!0):e.goodsObj.dataIsNull=0,e.goodsObj.moredata=o.assessData.length<perPageCount;for(var t=0;t<o.assessData.length;t++)o.assessData[t].rednums=[],o.assessData[t].graynums=[],o.assessData[t].rednums.length=o.assessData[t].num,o.assessData[t].graynums.length=5-o.assessData[t].num,o.assessData[t].addTime=new Date(1e3*parseInt(o.assessData[t].addTime)).toLocaleString();1==j&&e.goodsObj.assessData.length>0?(e.goodsObj.assessData=[],e.goodsObj.assessData=o.assessData):e.goodsObj.assessData=e.goodsObj.assessData.concat(o.assessData),j++,e.$broadcast("scroll.infiniteScrollComplete")}},function(e){console.log(e)})}function u(){i.getData("/api/ushoppingCart",{sessid:SESSID}).then(function(o){0==o.status&&(user_car_num=o.shoppingCart.length,e.user_Car_Num=user_car_num)},function(e){})}function m(o){o="["+o+"]",i.getData("/api/getAvgPrice",{sessid:SESSID,goods_id:JSON.stringify(o)}).then(function(o){0==o.status&&(e.goodsObj.freight=parseFloat(o.freight))})}function f(o){if(e.goodsObj.isCollect=!e.goodsObj.isCollect,e.goodsObj.isCollect){e.goodsObj.collectName="已收藏";var t={goods_id:o,is_integral:"0",sessid:SESSID};i.getData("/api/ucollection",t,"POST").then(function(o){0==o.status&&e.popTipsShow("收藏成功"),0!==o.status&&e.popTipsShow(o.desc)},function(e){throw new Error("enter goods detail error: "+e)})}else{e.goodsObj.collectName="收藏";var a={goods_id:o,sessid:SESSID};i.getData("/api/ucollection",a,"DELETE").then(function(o){0==o.status&&e.popTipsShow("已取消收藏"),0!==o.status&&e.popTipsShow(o.desc)},function(e){throw new Error("enter goods detail error: "+e)})}}function b(){s.go("tabs.homePage")}function h(){e.openModal()}function O(){e.goodsObj.isInfoActive=!0,e.goodsObj.isParamActive=!1,e.goodsObj.isAssessActive=!1,_.style.left="4.7%",e.goodsObj.selection="goodsInfo",o.resize(),e.goodsObj.moredata=!0}function S(){e.goodsObj.isInfoActive=!1,e.goodsObj.isAssessActive=!1,e.goodsObj.isParamActive=!0,_.style.left="38%",e.goodsObj.selection="goodsParam",o.resize(),e.goodsObj.moredata=!0,setTimeout(function(){o.resize()},200)}function D(){e.goodsObj.isInfoActive=!1,e.goodsObj.isParamActive=!1,e.goodsObj.isAssessActive=!0,_.style.left="71.4%",e.goodsObj.selection="goodsAssess",o.resize(),e.goodsObj.moredata=!1,j=1}function v(){"tabs.goodsDetail"==s.current.name?(s.go("tabs.shoppingCart_fromDetail"),r.nextDirection("forward")):(s.go("tabs.shoppingCart"),r.nextDirection("forward"))}function y(){e.collect.val=1,e.openModal()}function C(){e.goodsObj.goodsData.goodsNum=e.collect.val,t.path().indexOf("goodsDetail_collection")>-1?s.go("tabs.confirmOrder_personal",{goodsArray:JSON.stringify([e.goodsObj.goodsData])}):s.go("tabs.confirmOrder",{goodsArray:JSON.stringify([e.goodsObj.goodsData])})}e.goodsObj={is_integral:0,goods_id:a.goods_id,isSellOut:!1,collectName:"收藏",isCollect:!1,isInfoActive:!0,isParamActive:!1,isAssessActive:!1,IconRootURL:"",selection:"goodsInfo",goodsData:{},slideData:{bannerData:[],ishome:2},assessData:[],moredata:!1,collectOption:f,changeGoodsNums:h,selectInfo:O,selectParam:S,selectAssess:D,goShoppingCar:v,putinShoppingCar:y,buyNow:C,backHome:b,freight:0,loadMore:p,noneOfMoreData:!1,noneMsg:"",isShow:0,dragup:g,dataIsNull:0},e.$on("$ionicView.beforeEnter",function(){l.hideTabs=!0});var j=1,w={goods_id:a.goods_id,page:j,total:perPageCount};u(),setTimeout(function(){var o={integral:"0",id:e.goodsObj.goods_id};e.loadingShow(),i.getData("/api/getGoods",o).then(function(o){j=2,console.log(o),e.loadingOrPopTipsHide(),10001===o.status&&(e.popTipsShow("抱歉,该商品未上架!"),d(function(){window.history.back()},1e3)),0==o.goods_number&&(e.goodsObj.isSellOut=!0),e.goodsObj.slideData.bannerData=o.goods_introduction,e.goodsObj.goodsData=o,e.goodsObj.isShow=1,m(e.goodsObj.goods_id),1==e.goodsObj.goodsData.is_coll&&(e.goodsObj.isCollect=!0,e.goodsObj.collectName="已收藏")},function(e){throw new Error("enter goods detail error: "+e)})},500);var _=document.getElementById("slideLine");n.fromTemplateUrl("shopCarModal.html",{scope:e,animation:"slide-in-up"}).then(function(o){e.modal=o}),e.openModal=function(){e.modal.show()},e.$on("$destroy",function(){e.loadingOrPopTipsHide(),e.modal.remove()}),e.collect={val:1,reduce:function(){e.collect.val>1&&e.collect.val--},add:function(){e.collect.val<parseInt(e.goodsObj.goodsData.goods_number)?e.collect.val++:e.popTipsShow("抱歉,您添加的商品数量大于库存量")}},n.fromTemplateUrl("shopCarModal.html",{scope:e,animation:"slide-in-up"}).then(function(o){e.modal=o}),e.openModal=function(){e.modal.show(),e.modal.goodsData=e.goodsObj.goodsData,e.modal.IconRootURL=IconROOT_URL},e.addToShoppingCar=function(){if(e.goodsObj.isSellOut)return e.popTipsShow("抱歉,该商品没有库存了,加入购物车失败!"),void e.modal.hide();var o={goods_id:e.modal.goodsData.goods_id,num:e.collect.val,sessid:SESSID};i.getData("/api/ushoppingCart",o,"POST").then(function(o){0==o.status?(u(),e.user_Car_Num=user_car_num,e.modal.hide(),e.popTipsShow("加入购物车成功")):e.popTipsShow("加入购物车失败")},function(e){})},e.goToConfirmOrder=function(){return e.modal.hide(),e.goodsObj.isSellOut?void e.popTipsShow("抱歉,该商品没有库存了!"):(e.goodsObj.goodsData.goodsNum=e.collect.val,void(t.path().indexOf("goodsDetail_collection")>-1?s.go("tabs.confirmOrder_personal",{goodsArray:JSON.stringify([e.goodsObj.goodsData])}):s.go("tabs.confirmOrder",{goodsArray:JSON.stringify([e.goodsObj.goodsData])})))},e.rednums=[],e.graynums=[],function(o){e.rednums.length=o,e.graynums.length=5-o}(5),e.goodsIcons=["img1"]}]),angular.module("cftApp.homePage",[]).config(["$stateProvider",function(e){e.state("tabs.homePage",{url:"/homePage",views:{"tabs-homePage":{templateUrl:"homePage.html",controller:"homePageController"}}})}]).controller("homePageController",["$scope","$rootScope","$ionicPopup","HttpFactory","$ionicSideMenuDelegate","$state","$ionicNavBarDelegate","$ionicViewSwitcher","$ionicModal","$timeout","CftStore",function(e,o,t,a,s,r,n,i,l,d,c){function g(){e.homeObj.moredata&&e.homeObj.goodsDatas.length>0&&(e.homeObj.noneOfMoreData=!0)}function p(){j.blur()}function u(){j.blur()}function m(t){v=!1,j.blur(),r.go("tabs.sortedGoods",{searchStr:t}),o.hideTabs=!0,e.sideMenuObj.isSearch=!0,i.nextDirection("forward")}function f(){console.log("切换"),e.sideMenuObj.sideMenuOnOpened(0,0),s.toggleRight()}function b(e){v=!1,c.set("goodsName",e.goods_name);var o={goods_id:e.goods_id};a.getData("/api/clickGoods",o,"POST").then(function(e){},function(e){console.log("失败")}),r.go("tabs.goodsDetail",{is_integral:"0",goods_id:e.goods_id,goods_icon:e.goods_introduction}),i.nextDirection("forward")}function h(o){o.stopPropagation(),e.popTipsShow("商品已售罄")}function O(o,t){o.stopPropagation(),e.openModal(),e.modal.goodsData=t,e.modal.IconRootURL=IconROOT_URL}function S(){y=1,C.page=y,e.homeObj.noneOfMoreData=!1;var o={success:function(o){0==o.status&&(o.goodsData.length>=10?e.homeObj.moredata=!1:0==o.goodsData.length&&(e.homeObj.msgsIsNull=1,e.homeObj.emptyLogMsg="该推荐商品为空O(∩_∩)O~"),e.homeObj.slideData.bannerData=o.bannerData,e.homeObj.goodsDatas=o.goodsData,e.sideMenuObj.sortedSecondClassObj=o.cateData,e.$broadcast("scroll.refreshComplete")),y=2},error:function(e){}};a.getData("/api/getGoods",C).then(o.success,o.error)}function D(){C.page=y;var o={success:function(o){console.log(o),0==o.status&&(o.goodsData.length<perPageCount?(0==o.goodsData.length&&0==e.homeObj.goodsDatas.length?(e.homeObj.msgsIsNull=1,e.homeObj.emptyLogMsg="该推荐商品为空O(∩_∩)O~"):(e.homeObj.msgsIsNull=0,e.homeObj.emptyLogMsg=""),e.homeObj.moredata=!0):e.homeObj.moredata=!1,1==y&&(e.sideMenuObj.sortedSecondClassObj=o.cateData,e.homeObj.slideData.bannerData=o.bannerData),e.homeObj.goodsDatas=e.homeObj.goodsDatas.concat(o.goodsData),y++,e.$broadcast("scroll.infiniteScrollComplete"))},error:function(e){}};a.getData("/api/getGoods",C).then(o.success,o.error)}e.homeObj={integral:0,slideData:{bannerData:[],ishome:0},cateData:{},currentpage:1,sideObj:{},goodsDatas:[],moredata:!1,noneOfMoreData:!1,msgsIsNull:0,emptyLogMsg:"",sellOut:h,toggleRight:f,goDetail:b,takeShorpping:O,doRefresh:S,loadMore:D,goSearch:m,onScroll:p,swipeUp:u,dragup:g};var v=!0,y=1,C={total:perPageCount,page:y,integral:0,bannum:5,is_recom:1,sortKey:"on_saleTime"},j=document.getElementById("cft-textField");e.$on("$ionicView.enter",function(){s.isOpen()&&s.toggleRight(),e.sideMenuObj.sideMenuClose(),j=document.getElementById("cft-textField");var t=navigator.userAgent,a=t.indexOf("Android")>-1||t.indexOf("Adr")>-1;if(a){var r=document.body.clientHeight,n=document.body.clientHeight,i=document.getElementsByClassName("tabs")[0],l=!1;j.onfocus=function(){i.style.opacity=0,o.hideTabs=!0,l||d(function(){l=!0,document.body.style.position="absolute",document.body.style.top=document.body.offsetTop+"1px",document.body.style.position="static"},30)},j.onblur=function(){l=!1,i.style.opacity=1,setTimeout(function(){o.hideTabs=!1},40)},window.onresize=function(){document.body.clientHeight<r&&n>document.body.clientHeight&&(n=document.body.clientHeight,o.hideTabs=!0),document.body.clientHeight>n&&(j.blur(),o.hideTabs=!1)}}}),e.$on("$ionicView.beforeEnter",function(){o.hideTabs=!1,e.searchValue=""}),e.$on("home_sortedView",function(e,o){v=!1,setTimeout(function(){r.go("tabs.sortedGoods",{searchStr:"",cate_id:o}),i.nextDirection("forward")},300)}),e.collect={val:1,reduce:function(){e.collect.val>1&&e.collect.val--},add:function(){return e.collect.val>=e.modal.goodsData.goods_number?void e.popTipsShow("抱歉,您添加的商品数量大于库存量"):void e.collect.val++}},l.fromTemplateUrl("shopCarModal.html",{scope:e,animation:"slide-in-up"}).then(function(o){e.modal=o}),e.openModal=function(){e.collect.val=1,e.modal.show()},e.addToShoppingCar=function(){var o={goods_id:e.modal.goodsData.goods_id,num:e.collect.val,sessid:SESSID};a.getData("/api/ushoppingCart",o,"POST").then(function(o){0==o.status?(user_car_num+=1,e.user_Car_Num+=user_car_num,e.modal.hide(),e.popTipsShow("加入购物车成功")):e.popTipsShow("加入购物车失败")},function(e){})},e.goToConfirmOrder=function(){e.modal.goodsData.goodsNum=e.collect.val,e.modal.hide(),r.go("tabs.confirmOrder",{goodsArray:JSON.stringify([e.modal.goodsData])})},e.$on("$destroy",function(){e.modal.remove()})}]),angular.module("cftApp.integralGoodsDetail",[]).config(["$stateProvider",function(e){e.state("tabs.igDetail",{url:"/igDetail/:is_integral/:goods_id",views:{"tabs-integralStore":{templateUrl:"goodsDetail.html",controller:"integralDetailController"}}}).state("tabs.igDetail_personal",{url:"/igDetail_personal/:is_integral/:goods_id",views:{"tabs-personal":{templateUrl:"goodsDetail.html",controller:"integralDetailController"}}})}]).controller("integralDetailController",["$scope","$location","$ionicScrollDelegate","$state","$stateParams","$ionicModal","HttpFactory","$rootScope","$ionicLoading",function(e,o,t,a,s,r,n,i,l){function d(){e.goodsObj.moredata&&e.goodsObj.assessData.length>0&&(e.goodsObj.noneMsg="没有更多评论...")}function c(){console.log("loadMore"),console.log(S),D.page=S,n.getData("/api/assess",D).then(function(o){if(0==o.status){o.assessData.length<perPageCount?0==o.assessData.length&&e.goodsObj.assessData.length<=0?(e.goodsObj.noneOfMoreData=!1,e.goodsObj.dataIsNull=1,e.goodsObj.noneMsg=""):(e.goodsObj.dataIsNull=0,e.goodsObj.noneOfMoreData=!0):e.goodsObj.dataIsNull=0,e.goodsObj.moredata=o.assessData.length<perPageCount;for(var t=0;t<o.assessData.length;t++)o.assessData[t].rednums=[],o.assessData[t].graynums=[],o.assessData[t].rednums.length=o.assessData[t].num,o.assessData[t].graynums.length=5-o.assessData[t].num,o.assessData[t].addTime=new Date(1e3*parseInt(o.assessData[t].addTime)).toLocaleString();1==S&&e.goodsObj.assessData.length>0?(e.goodsObj.assessData=[],e.goodsObj.assessData=o.assessData):e.goodsObj.assessData=e.goodsObj.assessData.concat(o.assessData),S++,console.log(S),e.$broadcast("scroll.infiniteScrollComplete")}},function(e){console.log(e)})}function g(o){if(e.goodsObj.isCollect=!e.goodsObj.isCollect,e.goodsObj.isCollect){e.goodsObj.collectName="已收藏";var t={goods_id:o,is_integral:"1",sessid:SESSID};n.getData("/api/ucollection",t,"POST").then(function(o){0==o.status&&e.popTipsShow("收藏成功")},function(e){throw new Error("enter goods detail error: "+e)})}else{e.goodsObj.collectName="收藏";var a={goods_id:o,is_integral:"1",sessid:SESSID};n.getData("/api/ucollection",a,"DELETE").then(function(o){0==o.status?e.popTipsShow("已取消收藏"):e.popTipsShow(o.desc)},function(e){throw new Error("enter goods detail error: "+e)})}}function p(){localStorage.isFromIntegralToHomePage=!0,a.go("tabs.homePage")}function u(){}function m(){t.resize(),e.goodsObj.isInfoActive=!0,e.goodsObj.isParamActive=!1,e.goodsObj.isAssessActive=!1,v.style.left="4.7%",e.goodsObj.selection="goodsInfo",e.goodsObj.moredata=!0}function f(){t.resize(),e.goodsObj.isInfoActive=!1,e.goodsObj.isAssessActive=!1,e.goodsObj.isParamActive=!0,e.goodsObj.moredata=!0,v.style.left="38%",e.goodsObj.selection="goodsParam",setTimeout(function(){t.resize()},200)}function b(){t.resize(),e.goodsObj.isInfoActive=!1,e.goodsObj.isParamActive=!1,e.goodsObj.isAssessActive=!0,e.goodsObj.moredata=!1,v.style.left="71.4%",e.goodsObj.selection="goodsAssess",S=1}function h(){o.path().indexOf("igDetail_personal")>-1?a.go("tabs.confirmOrder_personal",{goodsArray:JSON.stringify([e.goodsObj.goodsData])}):a.go("tabs.confirmOrder_IG",{goodsArray:JSON.stringify([e.goodsObj.goodsData])})}e.goodsObj={is_integral:"1",isSellOut_ig:!1,collectName:"收藏",isCollect:!1,isInfoActive:!0,isParamActive:!1,isAssessActive:!1,selection:"goodsInfo",goodsData:{},slideData:{bannerData:[],ishome:2},assessData:[],moredata:!1,collectOption:g,changeGoodsNums:u,selectInfo:m,selectParam:f,selectAssess:b,backHome:p,convertOption:h,freight:0,loadMore:c,isShow:0,dragup:d,dataIsNull:0};var O={integral:e.goodsObj.is_integral,id:s.goods_id},S=1;e.$on("$ionicView.beforeEnter",function(){i.hideTabs=!0}),e.$on("$destroy",function(){e.loadingOrPopTipsHide()});var D={goods_id:s.goods_id,page:1,total:perPageCount};e.loadingShow(),setTimeout(function(){n.getData("/api/getGoods",O).then(function(o){e.loadingOrPopTipsHide(),0==o.status,10001===o.status&&(e.popTipsShow("抱歉,该商品未上架!"),setTimeout(function(){window.history.back()},1e3)),0==o.goods_number&&(e.goodsObj.isSellOut_ig=!0),e.goodsObj.slideData.bannerData=o.goods_introduction,e.goodsObj.goodsData=o,e.goodsObj.isShow=1,1==e.goodsObj.goodsData.is_coll&&(e.goodsObj.isCollect=!0,e.goodsObj.collectName="已收藏")},function(e){throw new Error("enter goods detail error: "+e)})},500),e.isInteg=s.isInteg;var v=document.getElementById("slideLine");e.goodsIcons=["img1"]}]),angular.module("cftApp.integralStore",["ctfApp.searchBar","cftApp.goodsDetail"]).config(["$stateProvider",function(e){e.state("tabs.integralStore",{url:"/integralStore",views:{"tabs-integralStore":{templateUrl:"integralStore.html",controller:"integralStoreController"}}})}]).controller("integralStoreController",["$scope","$rootScope","$ionicPopup","HttpFactory","$ionicSideMenuDelegate","$state","$ionicNavBarDelegate","$ionicViewSwitcher","$timeout","CftStore","$window",function(e,o,t,a,s,r,n,i,l,d,c){function g(){e.integralObj.moredata&&e.integralObj.totoalGoodsData.length>0&&(e.integralObj.noneOfMoreData=!0)}function p(){v.blur()}function u(e){S=!1,v.blur(),r.go("tabs.sortedIntegral",{searchStr:e}),o.hideTabs=!0,i.nextDirection("forward")}function m(){e.sideMenuObj.sideMenuOnOpened(1,0,e.integralObj.cateData),s.toggleRight()}function f(e){S=!1,d.set("goodsName",e.goods_name),o.hideTabs=!0,r.go("tabs.igDetail",{is_integral:"1",goods_id:e.goods_id})}function b(){console.log(e.integralObj.totoalGoodsData),e.integralObj.noneOfMoreData=!1,D=1,y.page=D;var o={success:function(o){0==o.status?(e.$broadcast("homeSlideData",e.integralObj.slideData),e.integralObj.totoalGoodsData=[],e.integralObj.totoalGoodsData=o.goodsData,console.log(e.integralObj.totoalGoodsData),e.integralObj.cateData=o.cateData,e.$broadcast("scroll.refreshComplete"),o.goodsData.length>=10?e.integralObj.moredata=!1:0==o.goodsData.length?(e.integralObj.msgsIsNull=1,e.integralObj.emptyLogMsg="兑换商品为空O(∩_∩)O~"):(e.integralObj.msgsIsNull=0,e.integralObj.emptyLogMsg=""),D=2):e.popTipsShow(o.desc)},error:function(e){console.log(e)}};a.getData("/api/getGoods",y).then(o.success,o.error)}function h(){console.log("loadMore"+D),console.log(e.integralObj.totoalGoodsData);var o={success:function(o){console.log("请求内部"),console.log(e.integralObj.totoalGoodsData),0==o.status?(o.goodsData.length<perPageCount?(e.integralObj.moredata=!0,0==o.goodsData.length&&0==e.integralObj.totoalGoodsData.length?(e.integralObj.msgsIsNull=1,e.integralObj.emptyLogMsg="兑换商品为空O(∩_∩)O~"):(e.integralObj.msgsIsNull=0,e.integralObj.emptyLogMsg="")):e.integralObj.moredata=!1,1==D&&(e.sideMenuObj.sortedSecondClassObj=o.cateData,e.integralObj.slideData.bannerData=o.bannerData),
e.integralObj.totoalGoodsData=e.integralObj.totoalGoodsData.concat(o.goodsData),D++,console.log(e.integralObj.totoalGoodsData)):e.popTipsShow(o.desc),e.$broadcast("scroll.infiniteScrollComplete")},error:function(e){console.log(e)}};y.page=D,a.getData("/api/getGoods",y).then(o.success,o.error)}function O(e,o){S=!1,e.stopPropagation(),r.go("tabs.confirmOrder_IG",{goodsArray:JSON.stringify([o])})}e.integralObj={goodsData:[],slideData:{bannerData:[],ishome:1},noneOfMoreData:!1,cateData:{},moredata:!1,currentpage:1,toggleRight:m,goDetail:f,doRefresh:b,loadMore:h,goSearch:u,convertOption:O,onScroll:p,dragup:g,msgsIsNull:0,emptyLogMsg:""},e.integralObj.totoalGoodsData=[];var S=!1,D=1;e.$on("integral_sortedView",function(e,o){S=!1,setTimeout(function(){r.go("tabs.sortedIntegral",{searchStr:"",cate_id:o})},300)});var v=document.getElementById("cft-textField_ig");e.$on("$ionicView.enter",function(){s.isOpen()&&s.toggleRight(),v=document.getElementById("cft-textField_ig");var e=navigator.userAgent,t=e.indexOf("Android")>-1||e.indexOf("Adr")>-1;!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);if(t){var a=document.body.clientHeight,r=document.body.clientHeight,n=document.getElementsByClassName("tabs")[0],i=!1;v.onfocus=function(){n.style.opacity=0,o.hideTabs=!0,i||l(function(){i=!0,document.body.style.position="absolute",document.body.style.top=document.body.offsetTop+"1px",document.body.style.position="static"},30)},v.onblur=function(){i=!1,n.style.opacity=1,setTimeout(function(){o.hideTabs=!1},40)},window.onresize=function(){document.body.clientHeight<a&&r>document.body.clientHeight&&(r=document.body.clientHeight,o.hideTabs=!0),document.body.clientHeight>r&&(v.blur(),o.hideTabs=!1)}}}),e.$on("$ionicView.beforeEnter",function(){o.hideTabs=!1,e.searchValue=""});var y={total:perPageCount,page:D,integral:1,bannum:5,is_recom:1,sortKey:"on_saleTime"}}]),angular.module("cftApp.myOrder",["ionic","cftApp.orderDetail"]).config(["$stateProvider",function(e){e.state("tabs.myOrder",{url:"/myOrder",cache:!1,views:{"tabs-personal":{templateUrl:"myOrder.html",controller:"myOrderController"}}})}]).controller("myOrderController",["$rootScope","$scope","$state","$ionicModal","$ionicViewSwitcher","$ionicPopup","$ionicScrollDelegate","$timeout","HttpFactory","CftStore","$stateParams",function(e,o,t,a,s,r,n,i,l,d,c){function g(){o.myOrder.moredata&&o.myOrder.orderDatas.length>0&&(o.myOrder.noMoreData=!0)}function p(){o.myOrder.noMoreData=!1,u()}function u(){y.page=1,l.getData("/api/Order",y).then(function(e){0==e.status&&(o.$broadcast("scroll.refreshComplete"),o.loadingOrPopTipsHide(),o.myOrder.orderDatas=e.orderData,e.orderData.length<perPageCount?0==e.orderData.length?(o.myOrder.dataIsNull=!0,o.myOrder.nullMsg="您的订单是空的O(∩_∩)O~"):(o.myOrder.dataIsNull=!1,o.myOrder.nullMsg=""):o.myOrder.nullMsg="",o.myOrder.moredata=e.orderData.length<10,y.page++)},function(e){})}function m(){l.getData("/api/Order",y).then(function(e){0==e.status?(o.loadingOrPopTipsHide(),e.orderData.length<perPageCount&&0==e.orderData.length&&0==o.myOrder.orderDatas.length?(o.myOrder.dataIsNull=!0,o.myOrder.nullMsg="当前订单列表是空的O(∩_∩)O~"):(o.myOrder.dataIsNull=!1,o.myOrder.nullMsg=""),o.myOrder.orderDatas=o.myOrder.orderDatas.concat(e.orderData),o.myOrder.moredata=e.orderData.length<10,y.page++):o.myOrder.moredata=!0,o.$broadcast("scroll.infiniteScrollComplete")},function(e){})}function f(e){t.go("tabs.orderDetail",{oid:e.ordercode})}function b(e){o.myOrder.dataIsNull=!1,o.myOrder.nullMsg="",o.myOrder.noMoreData=!1,o.myOrder.noneMsg="",n.$getByHandle("orderScroll").scrollTop(),o.myOrder.moredata=!0;var t=angular.element(e.currentTarget).children(),a=angular.element(e.target);if("全 部"==a.text()&&(y.page=1,o.myOrder.orderDatas=[],o.myOrder.moredata=!1,y.state="0",d.set("tabNum","0")),e.currentTarget!=e.target)switch(t.removeClass("active"),a.addClass("active"),y.page=1,o.myOrder.orderDatas=[],o.myOrder.moredata=!1,y.is_evaluation="",a.text()){case"待付款":d.set("tabNum","1"),y.state="7";break;case"待发货":d.set("tabNum","2"),y.state="1";break;case"待收货":y.state="2",d.set("tabNum","3");break;case"待评价":d.set("tabNum","4"),y.state="3",y.is_evaluation=2}}function h(e,t,a){e.stopPropagation(),r.show({cssClass:"myOrder",template:"确认要取消订单吗？",buttons:[{text:"取消",onTap:function(e){var o=angular.element(document.querySelector(".backdrop"));o.removeClass("visible"),o.removeClass("active");var t=angular.element(document.querySelector(".myBody"));t.removeClass("popup-open"),e.stopPropagation()}},{text:"确定",onTap:function(){var e=angular.element(document.querySelector(".backdrop"));e.removeClass("visible"),e.removeClass("active");var s=angular.element(document.querySelector(".myBody"));s.removeClass("popup-open");var r={sseid:SESSID,oid:a.ordercode,state:6};l.getData("/api/Order",r,"PATCH").then(function(e){0==e.status?(p(),o.myOrder.orderDatas[t].state="6",o.popTipsShow("取消成功!")):o.popTipsShow(e.desc)},function(e){})}}]})}function O(e,t){e.stopPropagation();var a={};1==o.myOrder.orderDatas[t].goods_data.length&&(a={oid:o.myOrder.orderDatas[t].ordercode}),o.myOrder.orderDatas[t].goods_data.length>1&&(a={moid:o.myOrder.orderDatas[t].ordercode}),o.loadingShow(),l.getData("/api/memOrderListPay",a,"POST").then(function(e){o.loadingOrPopTipsHide(),0==e.status?(e=e.parameters,wx.chooseWXPay({timestamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:"MD5",paySign:e.paySign,success:function(e){if("chooseWXPay:ok"==e.errMsg){var a={sseid:SESSID,oid:o.myOrder.orderDatas[t].ordercode,state:1};l.getData("/api/Order",a,"PATCH").then(function(e){o.myOrder.orderDatas[t].state="1",o.confirmObj.confirmOrderModalImg="images/confirmOrder.png",o.modal.show(),o.popTipsShow("付款成功"),p()},function(e){})}else o.popTipsShow("支付出错!")}})):o.popTipsShow(e.desc)},function(e){o.popTipsShow("访问异常!")})}function S(e,t){e.stopPropagation(),r.show({cssClass:"myOrder refund",template:'<p>申请退款</p><textarea id="applyMsg" ng-model="myOrder.applyMsg" placeholder="请输入申请退款的原因？" maxlength="100"></textarea><div>{{myOrder.applyMsg.length}}/100</div>',scope:o,buttons:[{text:"取消",onTap:function(e){var o=angular.element(document.querySelector(".backdrop"));o.removeClass("visible"),o.removeClass("active");var t=angular.element(document.querySelector(".myBody"));t.removeClass("popup-open"),e.stopPropagation()}},{text:"确定",onTap:function(){var e=angular.element(document.querySelector(".backdrop"));e.removeClass("visible"),e.removeClass("active");var a=angular.element(document.querySelector(".myBody"));a.removeClass("popup-open");var s={sseid:SESSID,oid:o.myOrder.orderDatas[t].ordercode,state:4,mess:o.myOrder.applyMsg};l.getData("/api/Order",s,"PATCH").then(function(e){0==e.status?(o.myOrder.orderDatas[t].state="4",o.popTipsShow("申请已提交!"),p()):o.popTipsShow(e.desc)},function(e){})}}]})}function D(e,t){e.stopPropagation(),r.show({cssClass:"myOrder sure",template:"确认是否已收到货？",buttons:[{text:"取消",onTap:function(e){var o=angular.element(document.querySelector(".backdrop"));o.removeClass("visible"),o.removeClass("active");var t=angular.element(document.querySelector(".myBody"));t.removeClass("popup-open"),e.stopPropagation()}},{text:"确定",onTap:function(){var e=angular.element(document.querySelector(".backdrop"));e.removeClass("visible"),e.removeClass("active");var a=angular.element(document.querySelector(".myBody"));a.removeClass("popup-open");var s={sseid:SESSID,oid:o.myOrder.orderDatas[t].ordercode,state:3};l.getData("/api/Order",s,"PATCH").then(function(e){0==e.status?(o.myOrder.orderDatas[t].state="3",o.popTipsShow("交易完成!"),p()):o.popTipsShow(e.desc)},function(e){})}}]})}function v(e,o){o.stopPropagation(),t.go("tabs.evaluatePage",{goodsMsg:e})}o.myOrder={keyWords:"",navData:b,orderDatas:[],stateInfos:["待付款","待发货","待收货","交易完成","退款中","已退款","交易关闭"],allData:"",cancelBill:h,payment:O,refund:S,confirm:D,appraise:v,goOrderDetail:f,IconRootURL:"",applyMsg:"",emptyMsg:"",moredata:!1,isEvaluate:!1,noMoreDataMsg:"",loadMore:m,doRefresh:p,noMoreData:!1,noneMsg:"",nullMsg:"",dataIsNull:!1,dragup:g};var y={page:1,total:10,state:"0",sessid:SESSID};o.myOrder.IconRootURL=IconROOT_URL,o.$on("$ionicView.beforeLeave",function(){d.set("personalInto","")}),o.$on("$ionicView.beforeEnter",function(){e.hideTabs=!0,console.log("tabNum"),console.log(d.get("tabNum"));var o=d.get("tabNum");"yes"==d.get("personalInto")||d.get("tabNum")||(o="0",console.log("第一个")),"yes"==d.get("personalInto")&&(o="0",console.log("第二个"));var t=angular.element(document.querySelector(".topListWrapper")).children();switch(t.removeClass("active"),angular.element(t[o]).addClass("active"),y.page=1,y.is_evaluation="",o){case"0":y.state="0";break;case"1":y.state="7";break;case"2":y.state="1";break;case"3":y.state="2";break;case"4":y.state="3",y.is_evaluation=2}}),o.$on("",function(e,o){setTimeout(function(){t.go("tabs.sortedGoods",{searchStr:"",cate_id:o}),s.nextDirection("forward")},300)}),a.fromTemplateUrl("confirmOrderModal.html",{scope:o,animation:"slide-in-enter"}).then(function(e){o.modal=e}),o.$on("$destroy",function(){o.modal.remove()})}]),angular.module("cftApp.napaStores",[]).config(["$stateProvider",function(e){e.state("tabs.napaStores",{url:"/napaStores",views:{"tabs-napaStores":{templateUrl:"napaStores.html",controller:"napaStoresController"}}})}]).controller("napaStoresController",["$scope","$state","HttpFactory","$ionicModal","$http",function(e,o,t,a,s){function r(){!d.moreData&&d.storesData.length>0&&(d.noMoreData=1)}function n(){d.noMoreData=0,l("refresh")}function i(){l("loadMore")}function l(o){var a={nums:5,province:e.napaStores.text,page:c};t.getData("/api/franchise",a).then(function(t){0==t.data.length&&0==d.storesData.length?(d.dataIsNull=1,d.nullMsg="暂无加盟店信息O(∩_∩)O~"):(d.dataIsNull=0,d.nullMsg=""),"refresh"==o&&(e.$broadcast("scroll.refreshComplete"),c=2,d.storesData=t.data),"loadMore"==o&&(c++,d.moreData=t.data.length>=perPageCount,d.storesData=d.storesData.concat(t.data),e.$broadcast("scroll.infiniteScrollComplete")),void 0==d.storesData&&e.popTipsShow("暂无加盟店信息!")},function(e){})}e.items=["1","2","3"];var d=e.napaObj={storesData:{},provinces:[],doRefresh:n,loadMore:i,moreData:!1,dataIsNull:0,nullMsg:"",noMoreData:0,dragup:r};e.napaStores={text:"定位中..."};var c=1;s.get("lib/city.json").success(function(o){e.napaObj.provinces=o,e.napaObj.provinces.splice(0,1)}),a.fromTemplateUrl("choiceAddressModal.html",{scope:e,animation:"fade-out",focusFirstInput:!0,backdropClickToClose:!0}).then(function(o){e.modal=o}),e.$on("$destroy",function(){e.modal.remove()}),setTimeout(function(){"定位中..."==e.napaStores.text&&e.popTipsShow("网络请求超时")},2e4),wx.getLocation({type:"wgs84",success:function(t){var a=t.latitude,s=t.longitude,r=new BMap.Point(parseFloat(s),parseFloat(a)),n=new BMap.Geocoder;n.getLocation(r,function(t){var a=t.addressComponents;a.province.indexOf("省")>-1&&(o.reload(),e.napaStores.text=a.province.split("省")[0])})},cancel:function(o){e.popTipsShow("用户拒绝授权获取地理位置")}}),e.$watch("napaStores.text",function(e,o){e!=o&&n()})}]),angular.module("cftApp.orderDetail",[]).config(["$stateProvider",function(e){e.state("tabs.orderDetail",{url:"/orderDetail/:oid",views:{"tabs-personal":{templateUrl:"orderDetail.html",controller:"orderDetailController"}}}).state("tabs.orderDetail_home",{url:"/orderDetail_home/:oid",views:{"tabs-homePage":{templateUrl:"orderDetail.html",controller:"orderDetailController"}}}).state("tabs.orderDetail_ig",{url:"/orderDetail_ig/:oid",views:{"tabs-integralStore":{templateUrl:"orderDetail.html",controller:"orderDetailController"}}})}]).controller("orderDetailController",["$scope","HttpFactory","$stateParams","CftStore","$ionicPopup","$state","$rootScope",function(e,o,t,a,s,r,n){function i(e){var t={goods_id:e.goods_id};a.set("goodsName",e.goods_name),o.getData("/api/clickGoods",t,"POST").then(function(e){console.log("成功")},function(e){console.log("失败")}),r.go("tabs.goodsDetail_orderDetail",{is_integral:"0",goods_id:e.goods_id,goods_icon:e.goods_introduction})}function l(t,a){s.show({cssClass:"myOrder",template:"确认要取消订单吗？",buttons:[{text:"取消",onTap:function(e){var o=angular.element(document.querySelector(".backdrop"));o.removeClass("visible"),o.removeClass("active");var t=angular.element(document.querySelector(".myBody"));t.removeClass("popup-open"),e.stopPropagation()}},{text:"确定",onTap:function(){var t=angular.element(document.querySelector(".backdrop"));t.removeClass("visible"),t.removeClass("active");var a=angular.element(document.querySelector(".myBody"));a.removeClass("popup-open");var s={sseid:SESSID,oid:e.orderDetail.orderData.ordercode,state:6};o.getData("/api/Order",s,"PATCH").then(function(o){e.orderDetail.orderData.state="6",e.popTipsShow("取消成功!")},function(e){})}}]})}function d(t,a){event.stopPropagation();var s={};1==t.goods_data.length&&(s={oid:t.ordercode}),t.goods_data.length>1&&(s={moid:t.ordercode}),e.loadingShow(),o.getData("/api/memOrderListPay",s,"POST").then(function(t){e.loadingOrPopTipsHide(),0==t.status?(t=t.parameters,wx.chooseWXPay({timestamp:t.timeStamp,nonceStr:t.nonceStr,package:t.package,signType:"MD5",paySign:t.paySign,success:function(t){if("chooseWXPay:ok"==t.errMsg){var a={sseid:SESSID,oid:e.orderDetail.orderData.ordercode,state:1};o.getData("/api/Order",a,"PATCH").then(function(o){e.orderDetail.orderData.state="1",e.confirmObj.confirmOrderModalImg="images/confirmOrder.png",e.modal.show()},function(e){})}else e.popTipsShow("支付出错!")}})):e.popTipsShow(t.desc)},function(o){e.popTipsShow("访问异常!")})}function c(t,a){a.stopPropagation(),s.show({cssClass:"myOrder refund",template:'<p>申请退款</p><textarea id="applyMsg" ng-model="orderDetail.applyMsg" placeholder="请输入申请退款的原因？" maxlength="100"></textarea><div>{{orderDetail.applyMsg.length}}/100</div>',scope:e,buttons:[{text:"取消",onTap:function(e){var o=angular.element(document.querySelector(".backdrop"));o.removeClass("visible"),o.removeClass("active");var t=angular.element(document.querySelector(".myBody"));t.removeClass("popup-open"),e.stopPropagation()}},{text:"确定",onTap:function(){var t=angular.element(document.querySelector(".backdrop"));t.removeClass("visible"),t.removeClass("active");var a=angular.element(document.querySelector(".myBody"));a.removeClass("popup-open");var s={sseid:SESSID,oid:e.orderDetail.orderData.ordercode,state:4,mess:e.orderDetail.applyMsg};o.getData("/api/Order",s,"PATCH").then(function(o){0==o.status?(e.orderDetail.orderData.state="4",e.popTipsShow("申请已提交!")):e.popTipsShow(o.desc)},function(e){})}}]})}function g(t,a){a.stopPropagation(),s.show({cssClass:"myOrder",template:"确认是否已收到货？",buttons:[{text:"取消",onTap:function(){var e=angular.element(document.querySelector(".backdrop"));e.removeClass("visible"),e.removeClass("active");var o=angular.element(document.querySelector(".myBody"));o.removeClass("popup-open"),a.stopPropagation()}},{text:"确定",onTap:function(){var a=angular.element(document.querySelector(".backdrop"));a.removeClass("visible"),a.removeClass("active");var s=angular.element(document.querySelector(".myBody"));s.removeClass("popup-open");var r={sseid:SESSID,oid:e.orderDetail.orderData.ordercode,state:3};o.getData("/api/Order",r,"PATCH").then(function(o){0==o.status?(t.state="3",e.popTipsShow("交易完成!")):e.popTipsShow(o.desc)},function(e){})}}]})}function p(e,o){o.stopPropagation(),r.go("tabs.evaluatePage",{goodsMsg:e})}e.orderDetail={orderData:null,applyMsg:"",stateInfos:["未付款","待发货","待收货","交易完成","退款中","已退款","交易关闭"],cancelBill:l,payment:d,confirm:g,appraise:p,refund:c,goDetail:i},e.$on("toDetailSuccess",function(o){"success"==o&&(e.orderDetail.orderData.is_evaluation="0")}),e.$on("$ionicView.beforeEnter",function(){n.hideTabs=!0});a.get("inputMsg");e.orderDetail.IconRootURL=IconROOT_URL,o.getData("/api/Order",{sessid:SESSID,oid:t.oid}).then(function(o){0==o.status&&(e.orderDetail.orderData=o.orderData)},function(e){console.log(e)})}]),angular.module("cftApp.payRecord",[]).config(["$stateProvider",function(e){e.state("tabs.payRecord",{url:"/payRecord",views:{"tabs-personal":{templateUrl:"payRecord.html",controller:"payRecordController"}}})}]).controller("payRecordController",["$scope","$rootScope","HttpFactory",function(e,o,t){function a(){e.payRecordObj.moredata&&e.payRecordObj.paylogOrderDatas.length>0&&(e.payRecordObj.noMoreData=1)}function s(){e.payRecordObj.noMoreData=0,n=1,i.page=n,e.payRecordObj.moredata=!1,e.payRecordObj.paylogOrderDatas=[],t.getData("/api/payOrderLog",i).then(function(o){0==o.status&&(0==o.paylogOrderDatas.length?(e.payRecordObj.dataIsNull=1,e.payRecordObj.nullMsg="您还没有交易记录O(∩_∩)O~"):(e.payRecordObj.dataIsNull=0,e.payRecordObj.nullMsg=""),n=2,e.payRecordObj.paylogOrderDatas=o.paylogOrderDatas),e.$broadcast("scroll.refreshComplete")},function(e){})}function r(){i.page=n,t.getData("/api/payOrderLog",i).then(function(o){0==o.status&&(o.paylogOrderDatas.length<perPageCount?(e.payRecordObj.moredata=!0,0==o.paylogOrderDatas.length&&0==e.payRecordObj.paylogOrderDatas.length&&(e.payRecordObj.dataIsNull=1,e.payRecordObj.nullMsg="您还没有交易记录O(∩_∩)O~")):e.payRecordObj.moredata=!1,n++,e.payRecordObj.paylogOrderDatas=e.payRecordObj.paylogOrderDatas.concat(o.paylogOrderDatas)),e.$broadcast("scroll.infiniteScrollComplete")},function(e){})}e.$on("$ionicView.beforeEnter",function(){o.hideTabs=!0}),e.payRecordObj={doRefresh:s,loadMore:r,moredata:!1,paylogOrderDatas:[],dataIsNull:0,nullMsg:"",dragup:a,noMoreData:0};var n=1,i={total:perPageCount,page:n,sessid:SESSID}}]),angular.module("cftApp.personal",[]).config(["$stateProvider",function(e){e.state("tabs.personal",{url:"/personal",views:{"tabs-personal":{templateUrl:"personal.html",controller:"personalController"}}})}]).controller("personalController",["$scope","$rootScope","$state","$ionicViewSwitcher","$ionicModal","MainData","HttpFactory","CftStore","$ionicSideMenuDelegate",function(e,o,t,a,s,r,n,i,l){function d(){t.go("tabs.myOrder"),i.set("personalInto","yes")}function c(){t.go("tabs.collectionPager")}function g(){t.go("tabs.totalScore")}function p(){t.go("tabs.shoppingCart")}function u(){r.isFromPersonToReceiptAddress=!0,t.go("tabs.receiptAddress")}function m(){t.go("tabs.payRecord")}function f(){}function b(){e.modal.show()}e.personal={userName:localStorage.userName,headimgurl:localStorage.headimgurl,creditNum:localStorage.creditNum?localStorage.creditNum:0,showOrder:d,showCollect:c,showShoppingCar:p,showCredit:g,showAddress:u,showPay:m,showAttention:f,share:b},e.$on("userInfo",function(o,t){e.personal.userName=t.userName,e.personal.headimgurl=t.headimgurl,e.personal.creditNum=t.creditNum?t.creditNum:0}),e.$on("$ionicView.beforeEnter",function(){o.hideTabs=!1;var t={sessid:SESSID};i.set("tabNum","0"),n.getData("/api/memberInfo",t).then(function(o){0==o.status&&(e.personal.creditNum=o.integral,i.set("creditNum",o.integral))},function(e){console.log(e)})}),s.fromTemplateUrl("shareModal.html",{scope:e,animation:"fade-in"}).then(function(o){e.modal=o}),e.$on("$ionicView.beforeLeave",function(){e.modal.hide()}),e.$on("$ionicView.enter",function(){l.isOpen()&&l.toggleRight()}),e.$on("$destroy",function(){e.modal.remove()})}]),angular.module("cftApp.receiptAddress",[]).config(["$stateProvider",function(e){e.state("tabs.receiptAddress",{url:"/receiptAddress",views:{"tabs-personal":{templateUrl:"receiptAddress.html",controller:"receiptAddressController"}}}).state("tabs.receiptAddress_IG",{url:"/receiptAddress_IG",views:{"tabs-integralStore":{templateUrl:"receiptAddress.html",controller:"receiptAddressController"}}}).state("tabs.receiptAddress_home",{url:"/receiptAddress_home",views:{"tabs-homePage":{templateUrl:"receiptAddress.html",controller:"receiptAddressController"}}})}]).controller("receiptAddressController",["$scope","$location","$rootScope","$ionicPopup","$timeout","HttpFactory","$ionicModal","$http","MainData",function(e,o,t,a,s,r,n,i,l){function d(){e.addressObj.moredata&&e.addressObj.adreessListDatas.length>0&&(e.addressObj.noMoreData=1,e.addressObj.noMoreDataMsg="没有更多收货地址...")}function c(o,t,a){if(void 0==o?(o=0,t=e.addressObj.adreessListDatas[0]):(a.stopPropagation(),l.userSelectAddress="skip"),e.addressObj.adreessListDatas.length){for(var s=0;s<e.addressObj.adreessListDatas.length;s++)e.addressObj.adreessListDatas[s].setdefault=0;e.addressObj.adreessListDatas[o].setdefault=1;var n={id:t.id,setdefault:1,sessid:SESSID};r.getData("/api/uAddress",n,"PATCH").then(function(e){0==e.status},function(e){})}}function g(o){angular.forEach(e.addressObj.provinces,function(t){t.name==o&&(e.addressObj.cities=t.sub)})}function p(o){if(e.loadingShow(),o.province=e.addressObj.selectedProvince,o.city=e.addressObj.selectedCity,o.sessid=SESSID,"请选择"==o.province&&(o.province=""),"请选择"==o.city&&(o.city=""),""==o.vname||""==o.tel||""==o.address)return void e.popTipsShow("请补全地址信息");if(!/^1(3|4|5|7|8)\d{9}$/.test(o.tel))return void e.popTipsShow("手机号输入有误");if(e.addressObj.closeModal(),C){var a=o.setdefault;o.setdefault="",r.getData("/api/uAddress",o,"PATCH").then(function(s){t.hideTabs=!0,"0"==s.status?(o.setdefault=a,l.userSelectAddress=o,e.loadingOrPopTipsHide(),e.popTipsShow("地址修改成功")):(e.loadingOrPopTipsHide(),e.popTipsShow("地址修改失败"))},function(e){})}else e.addressObj.dataIsNull=!1,r.getData("/api/uAddress",o,"POST").then(function(o){"0"==o.status?(t.hideTabs=!0,f("新增保存")):(e.loadingOrPopTipsHide(),e.popTipsShow("地址保存失败"))},function(e){})}function u(){e.openModal()}function m(o){l.isFromPersonToReceiptAddress||(l.userSelectAddress=e.addressObj.adreessListDatas[o],window.history.back())}function f(o){y=1,e.addressObj.noMoreData=0,e.addressObj.noMoreDataMsg="";var t={success:function(t){0==t.status&&(0!=t.addressData.length?(e.addressObj.adreessListDatas=t.addressData,e.addressObj.dataIsNull=!1,t.addressData.length>=10?e.addressObj.moredata=!1:e.addressObj.moredata=!0,"新增保存"==o&&(e.loadingOrPopTipsHide(),e.popTipsShow("地址保存成功"),1==e.addressObj.adreessListDatas.length&&(e.addressObj.adreessListDatas[0].setdefault=1,c()))):e.addressObj.dataIsNull=!0,y++),e.$broadcast("scroll.refreshComplete")},error:function(e){}},a={page:y,sessid:SESSID};r.getData("/api/uAddress",a,"GET").then(t.success,t.error)}function b(){var o={page:y,sessid:SESSID};r.getData("/api/uAddress",o,"GET").then(function(o){0==o.status&&(0==o.addressData.length&&0==e.addressObj.adreessListDatas.length?(e.addressObj.emptyPromptStr="您的收货地址为空(^o^)/~",e.addressObj.dataIsNull=!0):e.addressObj.dataIsNull=!1,o.addressData.length<perPageCount?e.addressObj.moredata=!0:e.addressObj.moredata=!1,e.addressObj.adreessListDatas=e.addressObj.adreessListDatas.concat(o.addressData),y++,e.$broadcast("scroll.infiniteScrollComplete"))},function(o){e.addressObj.moredata=!0,e.popTipsShow("访问异常!")})}function h(o,t,a){"edit"==o?(C=!0,a.stopPropagation(),e.addressOptionObj=t,e.addressObj.selectedProvince=t.province,angular.forEach(e.addressObj.provinces,function(o){o.name==t.province&&(e.addressObj.cities=o.sub)}),e.addressObj.selectedCity=t.city,e.addressOptionObj.title="编辑收货地址"):(C=!1,e.addressObj.selectedProvince="",e.addressObj.selectedCity="",e.addressObj.cities=[],e.addressOptionObj={vname:"",tel:"",province:"",city:"",address:"",code:""},e.addressOptionObj.title="新增收货地址"),e.addressModal.show()}function O(o,t,s){s.stopPropagation();a.show({cssClass:"myOrder deleteAddress",template:"确认要删除该地址吗？",scope:e,buttons:[{text:"取消",type:"",onTap:function(e){var o=angular.element(document.querySelector(".backdrop"));o.removeClass("visible"),o.removeClass("active");var t=angular.element(document.querySelector(".myBody"));t.removeClass("popup-open"),e.stopPropagation()}},{text:"确定",type:"",onTap:function(a){var s=angular.element(document.querySelector(".backdrop"));s.removeClass("visible"),s.removeClass("active");var n=angular.element(document.querySelector(".myBody"));n.removeClass("popup-open");var i=t.id;0==e.addressObj.adreessListDatas.length?e.addressObj.dataIsNull=!0:e.addressObj.dataIsNull=!1,r.getData("/api/uAddress",{id:i,sessid:SESSID},"DELETE").then(function(t){"0"==t.status?(l.userSelectAddress="continue",e.popTipsShow("删除成功"),e.addressObj.adreessListDatas.length&&1==e.addressObj.adreessListDatas[o].setdefault?(e.addressObj.adreessListDatas.splice(o,1),c()):e.addressObj.adreessListDatas.splice(o,1)):e.popTipsShow(t.desc)},function(e){})}}]})}function S(){e.addressModal.hide()}function D(){e.addressModal.hide()}function v(o){j=o,"省份"==o&&(e.napaObj.provinces=e.addressObj.provinces),"城市"==j&&(g(e.addressObj.selectedProvince),e.napaObj.provinces=e.addressObj.cities),e.selectModal.show()}e.$on("$ionicView.beforeEnter",function(){t.hideTabs=!0}),e.napaObj={provinces:[]},e.napaStores={text:""},e.addressObj={moredata:!1,adreessListDatas:[],addressModal:{vname:"",tel:"",province:"",city:"",address:"",code:""},emptyPromptStr:"",provinces:[],cities:[],selectedProvince:"",selectedCity:"",selectedChange:g,dataIsNull:!1,addAddress:u,cancelAdd:S,saveAddress:p,closeModal:D,openModal:h,changeDefault:c,showConfirm:O,doRefresh:f,loadMore:b,selectAddress_user:m,selectAddressModalShow:v,noMoreData:0,noMoreDataMsg:"",dragup:d};var y=1,C=!1;e.addressOptionObj={},i.get("lib/city.json").success(function(o){e.addressObj.provinces=o,e.addressObj.provinces.splice(0,1),angular.forEach(e.addressObj.provinces,function(e){e.hasOwnProperty("sub")&&e.sub.splice(0,1)})}),n.fromTemplateUrl("editAddressModal.html",{scope:e,animation:"slide-in-up"}).then(function(o){e.addressModal=o}),n.fromTemplateUrl("choiceAddressModal.html",{scope:e,animation:"fade-out",focusFirstInput:!0,backdropClickToClose:!0}).then(function(o){e.selectModal=o}),e.doSome=function(){},e.$on("$destroy",function(){l.isFromPersonToReceiptAddress=!1,e.addressModal.remove(),e.selectModal.remove(),e.loadingOrPopTipsHide()});var j="省份";e.modal={hide:function(){"省份"==j&&(e.addressObj.selectedProvince=e.napaStores.text,e.addressObj.selectedCity=""),"城市"==j&&(e.addressObj.selectedCity=e.napaStores.text),e.selectModal.hide()}}}]),angular.module("cftApp.scanCodePayment",[]).config(["$stateProvider",function(e){e.state("tabs.scanCodePayment",{url:"/scanCodePayment",views:{"tabs-napaStores":{templateUrl:"scanCodePayment.html",controller:"scanCodePaymentController"}}})}]).controller("scanCodePaymentController",["$scope","$rootScope","$ionicPopup","$timeout","$ionicModal","HttpFactory","$stateParams",function(e,o,t,a,s,r,n){function i(){return 0!=e.scanCodeObj.price&&e.scanCodeObj.price?(e.loadingShow(),void r.getData("/api/wxFranchise",{sessid:SESSID,franchise_id:3,price:e.scanCodeObj.price},"POST").then(function(o){e.loadingOrPopTipsHide(),0==o.status?(o=o.parameters,wx.chooseWXPay({timestamp:o.timeStamp,nonceStr:o.nonceStr,package:o.package,signType:"MD5",paySign:o.paySign,success:function(o){"chooseWXPay:ok"==o.errMsg||e.popTipsShow("支付出错!")}})):e.popTipsShow(o.desc)},function(e){})):void e.popTipsShow("请输入您要付款的金额!")}e.$on("$ionicView.beforeEnter",function(){o.hideTabs=!0}),e.scanCodeObj={price:null,confirmPayment:i}}]),angular.module("cftApp.shoppingCart",["ionic"]).config(["$stateProvider",function(e){e.state("tabs.shoppingCart",{url:"/shoppingCart",views:{"tabs-personal":{templateUrl:"shoppingCart.html",controller:"shoppingCartController"}}}),e.state("tabs.shoppingCart_fromDetail",{url:"/shoppingCart_fromDetail",views:{"tabs-homePage":{templateUrl:"shoppingCart.html",controller:"shoppingCartController"}}})}]).controller("shoppingCartController",["$scope","$rootScope","$state","$ionicPopup","$timeout","$ionicViewSwitcher","HttpFactory","MainData","CftStore",function(e,o,t,a,s,r,n,i,l){function d(){e.shoppingCart.isShowInfinite||(e.shoppingCart.noneOfMoreData=!0,e.shoppingCart.noneMsg="没有更多商品...")}function c(){var o="/api/ushoppingCart",t={page:h,sessid:SESSID};s(function(){n.getData(o,t).then(function(o){console.log(o),o.shoppingCart.length<10?(0==o.shoppingCart.length&&(e.shoppingCart.noneOfMoreData=!1,e.shoppingCart.noneMsg="",e.shoppingCart.emptyShopCarStr="您的购物车是空的O(∩_∩)O~"),e.shoppingCart.isShowInfinite=!1):(e.shoppingCart.isShowInfinite=!0,e.shoppingCart.noneOfMoreData=!1),e.shoppingCart.CartList=e.shoppingCart.CartList.concat(o.shoppingCart),e.$broadcast("scroll.infiniteScrollComplete"),h++},function(o){e.shoppingCart.isShowInfinite=!1,e.popTipsShow("获取数据失败")})},300)}function g(){h=1;var o="/api/ushoppingCart",t={page:h,sessid:SESSID};e.shoppingCart.noneOfMoreData=!1,e.shoppingCart.noneMsg="",n.getData(o,t).then(function(o){o.shoppingCart.length>=10?(e.shoppingCart.noneOfMoreData=!1,e.shoppingCart.isShowInfinite=!0,e.shoppingCart.noneMsg=""):0==o.shoppingCart.length&&(e.shoppingCart.noneMsg="",e.shoppingCart.noneOfMoreData=!1,e.shoppingCart.emptyShopCarStr="您的购物车是空的O(∩_∩)O~"),e.shoppingCart.CartList=o.shoppingCart,h++}).finally(function(){e.$broadcast("scroll.refreshComplete")}),e.shoppingCart.SelectAll=!0,e.shoppingCart.CartMoney=0,e.shoppingCart.CartCount=0}function p(){for(var o=0,t=0,a=document.querySelectorAll(".radio>input"),s=0;s<a.length;s++)1==a[s].checked&&1==e.shoppingCart.CartList[s].is_Have&&(o+=e.shoppingCart.CartList[s].price*e.shoppingCart.CartList[s].num,t+=Number(e.shoppingCart.CartList[s].num));e.shoppingCart.CartMoney=o,e.shoppingCart.CartCount=t}function u(){e.shoppingCart.SelectAll=!e.shoppingCart.SelectAll;var o=angular.element(document.querySelectorAll(".radio>input"));if(e.shoppingCart.SelectAll)e.shoppingCart.selectedArray=[],o.attr("checked","");else{o.attr("checked","true");for(var t=0;t<e.shoppingCart.CartList.length;t++)1==e.shoppingCart.CartList[t].is_Have&&1==e.shoppingCart.CartList[t].is_on_sale&&e.shoppingCart.selectedArray.push(e.shoppingCart.CartList[t])}console.log("选中所有"),console.log(e.shoppingCart.selectedArray),p()}function m(o){p();for(var t=document.querySelectorAll(".radio>input"),a=[],s=0;s<t.length;s++)a=a.concat(t[s].checked);for(var r,n=0;n<a.length;n++)r+=a[n]+"";r.indexOf("false"),e.shoppingCart.SelectAll=r.indexOf("false")>0;for(var i="a",l=0;l<e.shoppingCart.selectedArray.length;l++)if(e.shoppingCart.CartList[o].$$hashKey==e.shoppingCart.selectedArray[l].$$hashKey){i=l,e.shoppingCart.selectedArray.splice(l,1);break}console.log("不知道要干啥"),console.log(e.shoppingCart.selectedArray),"a"==i&&e.shoppingCart.selectedArray.push(e.shoppingCart.CartList[o]),console.log(e.shoppingCart.selectedArray)}function f(){if(console.log(e.shoppingCart.selectedArray),0==e.shoppingCart.selectedArray.length)return void e.popTipsShow("您未选择任何商品!");for(var o=0;o<e.shoppingCart.selectedArray.length;o++)e.shoppingCart.selectedArray[o].goodsNum=e.shoppingCart.selectedArray[o].num,e.shoppingCart.selectedArray[o].is_integral=0,e.shoppingCart.selectedArray[o].goods_id=e.shoppingCart.selectedArray[o].g_id;i.shopping_car_goodsArray=JSON.stringify(e.shoppingCart.selectedArray),"tabs.shoppingCart_fromDetail"==t.current.name?t.go("tabs.confirmOrder",{goodsArray:"value传值"}):(l.set("confirmGoodsArr",JSON.stringify(e.shoppingCart.selectedArray)),t.go("tabs.confirmOrder_personal",{goodsArray:"value传值"}))}function b(o){a.show({cssClass:"myOrder",template:"确认要删除该商品吗？",buttons:[{text:"取消",type:"button-clear button-dark",onTap:function(e){var o=angular.element(document.querySelector(".backdrop"));o.removeClass("visible"),o.removeClass("active");var t=angular.element(document.querySelector(".myBody"));t.removeClass("popup-open"),e.stopPropagation()}},{text:"确定",type:"button-clear button-assertive",onTap:function(t){var a=angular.element(document.querySelector(".backdrop"));a.removeClass("visible"),a.removeClass("active");var s=angular.element(document.querySelector(".myBody"));s.removeClass("popup-open");var r={id:e.shoppingCart.CartList[o].id,sessid:SESSID};n.getData("/api/ushoppingCart",r,"DELETE").then(function(t){if(0==t.status){var a=document.querySelectorAll(".radio>input");a[o]&&a[o].checked&&(a[o].checked=""),p(),e.shoppingCart.CartList.splice(o,1),e.popTipsShow("删除成功")}else e.popTipsShow("删除失败")},function(o){e.popTipsShow("获取数据失败")})}}]})}e.$on("$ionicView.beforeEnter",function(){o.hideTabs=!0,l.set("confirmGoodsArr","")}),e.shoppingCart={CartList:[],CartMoney:0,CartCount:0,isShowInfinite:!0,emptyShopCarStr:"",SelectAll:!0,loadMore:c,doRefresh:g,confirmDelete:b,ifSelectAll:u,ifSelect:m,selectedArray:[],goToSettlement:f,
noneOfMoreData:!1,noneMsg:"",drapup:d};var h=1;e.lookGoodDetail=function(o,a){return 1!=a.is_on_sale?void e.popTipsShow("商品已下架"):(l.set("goodsName",a.title),void("tabs.shoppingCart_fromDetail"==t.current.name?(t.go("tabs.goodsDetail",{is_integral:"0",goods_id:e.shoppingCart.CartList[o].g_id,goods_icon:e.shoppingCart.CartList[o].litpic}),r.nextDirection("forward")):(t.go("tabs.goodsDetail_collection",{is_integral:"0",goods_id:e.shoppingCart.CartList[o].g_id,goods_icon:e.shoppingCart.CartList[o].litpic}),r.nextDirection("forward"))))}}]),angular.module("cftApp.sortedGoods",[]).config(["$stateProvider",function(e){e.state("tabs.sortedGoods",{url:"/sortedGoods/:searchStr/:cate_id",views:{"tabs-homePage":{templateUrl:"sortedGoods.html",controller:"sortedGoodsController"}}})}]).controller("sortedGoodsController",["$scope","$stateParams","$state","$ionicSideMenuDelegate","HttpFactory","$ionicViewSwitcher","$ionicLoading","$ionicScrollDelegate","$ionicModal","$rootScope",function(e,o,t,a,s,r,n,i,l,d){function c(){O.moredata&&O.goodsDatas.length>0&&(O.noneOfMoreData=!0,O.noneMsg="没有更多商品...")}function g(){void 0==D.searchStr&&(D.searchStr=""),O.noneOfMoreData=!1,O.noneMsg="",S=1,D.page=S,O.moredata=!1;var o={success:function(o){0==o.status&&(o.goodsData.length<perPageCount?(O.moredata=!0,0==o.goodsData.length&&0==O.goodsDatas.length?(e.sortedGoodsObj.nullMsg="没有此类商品哦O(∩_∩)O~",e.sortedGoodsObj.dataIsNull=1):(e.sortedGoodsObj.nullMsg="",e.sortedGoodsObj.dataIsNull=0)):O.moredata=!1,O.goodsDatas=o.goodsData,S++),e.$broadcast("scroll.refreshComplete")},error:function(e){}};s.getData("/api/getGoods",D).then(o.success,o.error)}function p(){return D.page=S,1==S?void setTimeout(function(){var o={success:function(o){0==o.status&&(e.sortedGoodsObj.cateData=o.cateData,o.goodsData.length<perPageCount?(0==o.goodsData.length&&0==O.goodsDatas.length?(e.sortedGoodsObj.dataIsNull=1,e.sortedGoodsObj.nullMsg="没有此类商品哦O(∩_∩)O~"):(e.sortedGoodsObj.dataIsNull=0,e.sortedGoodsObj.nullMsg=""),O.moredata=!0):O.moredata=!1,O.goodsDatas=[],O.goodsDatas=O.goodsDatas.concat(o.goodsData),S++),e.$broadcast("scroll.infiniteScrollComplete")},error:function(e){}};s.getData("/api/getGoods",D).then(o.success,o.error)},300):(D.page=S,void s.getData("/api/getGoods",D).then(function(o){0==o.status&&(o.goodsData.length<perPageCount?O.moredata=!0:O.moredata=!1,O.goodsDatas=O.goodsDatas.concat(o.goodsData),S++),e.$broadcast("scroll.infiniteScrollComplete")},function(e){}))}function u(e){t.go("tabs.goodsDetail",{is_integral:0,goods_id:e.goods_id})}function m(o){void 0==o&&(o=""),D["cate_id[]"]="",D.startPrice="",D.endPrice="",D.searchStr=o,e.sideMenuObj.isSearch=!0,O.goodsDatas=[],g()}function f(o,t){o.stopPropagation(),e.openModal(),e.modal.goodsData=t,e.modal.IconRootURL=IconROOT_URL}function b(e){O.moredata=!1,S=1,e.page=S,i.scrollTop(),i.resize()}function h(o){function t(e){O.goodsDatas=[],D.sortKey=e,D.sort="asc",b(D)}function s(e){O.goodsDatas=[],D.sortKey=e,D.sort="desc",b(D)}e.loadingShow(),e.loadingOrPopTipsHide();var r=angular.element(o.currentTarget).children(),n=angular.element(o.target);switch(O.noneOfMoreData=!1,O.noneMsg="",O.moredata=!1,n.text()){case"综合":e.sortedGoodsObj.dataIsNull=0,s("coll");break;case"销量":e.sortedGoodsObj.dataIsNull=0,s("hot");break;case"价格":e.sortedGoodsObj.dataIsNull=0,n.hasClass("active")?(e.sortedGoodsObj.priceTapNums++,e.sortedGoodsObj.priceTapNums>0&&(e.sortedGoodsObj.isPriceHeigh=!e.sortedGoodsObj.isPriceHeigh,e.sortedGoodsObj.isPriceHeigh?(t("shop_price"),e.sortedGoodsObj.arrowImg="images/shangArrow.png"):(s("shop_price"),e.sortedGoodsObj.arrowImg="images/xiaoArrow.png"))):(e.sortedGoodsObj.priceTapNums=0,e.sortedGoodsObj.isPriceHeigh?(e.sortedGoodsObj.arrowImg="images/shangArrow.png",t("shop_price")):(s("shop_price"),e.sortedGoodsObj.arrowImg="images/xiaoArrow.png"));break;case"筛选":console.log("cate_data。。。。。"),console.log(e.sortedGoodsObj.cateData),e.sideMenuObj.sideMenuOnOpened(0,1,e.sortedGoodsObj.cateData),a.toggleRight()}n.toString().indexOf("Image")!=-1?"筛选"!=n.parent().text()&&(r.removeClass("active"),n.parent().addClass("active")):"筛选"==n.text()||(r.removeClass("active"),n.addClass("active"))}var O=e.sortedGoodsObj={priceTapNums:0,isPriceHeigh:!0,hotTapNums:0,isHotDesc:!0,moredata:!1,noneOfMoreData:!1,dataIsNull:0,nullMsg:"",sortWords:"",cateData:null,goodsDatas:[],goDetail:u,takeShopping:f,sortAction:h,goSearch:m,doRefresh:g,loadMore:p,currentPage:1,arrowImg:"images/shangArrow.png",hotImgeName:"xiaoArrow.png",noneMsg:"",dragup:c};e.$on("$ionicView.beforeEnter",function(){d.hideTabs=!0});var S=1,D={integral:0,total:perPageCount,page:S,searchStr:o.searchStr,"cate_id[]":""==o.cate_id?"":o.cate_id.split(",")};e.goToConfirmOrder=function(){e.modal.goodsData.goodsNum=e.collect.val,e.modal.hide(),t.go("tabs.confirmOrder",{goodsArray:JSON.stringify([e.modal.goodsData])})},e.collect={val:1,reduce:function(){e.collect.val>1&&e.collect.val--},add:function(){return e.collect.val>e.modal.goodsData.goods_number?void e.popTipsShow("抱歉,您添加的商品数量大于库存量"):void e.collect.val++}},l.fromTemplateUrl("shopCarModal.html",{scope:e,animation:"slide-in-up"}).then(function(o){e.modal=o}),e.openModal=function(){e.collect.val=1,e.modal.show()},e.addToShoppingCar=function(){var o={goods_id:e.modal.goodsData.goods_id,num:e.collect.val,sessid:SESSID};s.getData("/api/ushoppingCart",o,"POST").then(function(o){0==o.status?(user_car_num+=1,e.user_Car_Num=user_car_num,e.modal.hide(),e.popTipsShow("加入购物车成功")):e.popTipsShow("加入购物车失败")},function(e){})},e.$on("sureSorted",function(o,t){e.searchStr="",O.currentPage=1,D["cate_id[]"]=[],D["cate_id[]"]=t.sortedSelectedIDS,S=1,D.page=1,D.startPrice=t.minPrice,D.endPrice=t.maxPrice,D.searchStr="",O.goodsDatas=[],setTimeout(function(){g()},200)}),e.$on("$ionicView.enter",function(){d.hideTabs=!0,e.sideMenuObj.sideMenuClose();var o=navigator.userAgent,t=o.indexOf("Android")>-1||o.indexOf("Adr")>-1;if(t){var s=document.body.clientHeight,r=document.body.clientHeight;document.getElementsByClassName("tabs")[0];window.onresize=function(){if(document.body.clientHeight<s&&r>document.body.clientHeight&&(r=document.body.clientHeight,d.hideTabs=!0),document.body.clientHeight>r&&a.isOpen()){var e=document.querySelector(".minPriceInput"),o=document.querySelector(".maxPriceInput");e.blur(),o.blur()}}}})}]),angular.module("cftApp.sortedIntegral",[]).config(["$stateProvider",function(e){e.state("tabs.sortedIntegral",{url:"/sortedIntegral/:searchStr/:cate_id",views:{"tabs-integralStore":{templateUrl:"sortedIntegralGoods.html",controller:"sortedIntegralController"}}})}]).controller("sortedIntegralController",["$scope","$stateParams","$state","$ionicSideMenuDelegate","HttpFactory","$ionicViewSwitcher","$ionicScrollDelegate","$rootScope",function(e,o,t,a,s,r,n,i){function l(){b.moredata&&b.goodsDatas.length>0&&(b.noneOfMoreData=!0,b.noneMsg="没有更多商品...")}function d(){void 0==O.searchStr&&(O.searchStr=""),b.noneOfMoreData=!1,b.noneMsg="",h=1,O.page=h,console.log("+++++"+h),b.moredata=!1;var o={success:function(o){h=2,0==o.status&&(o.goodsData.length<perPageCount?(b.moredata=!0,0==o.goodsData.length?(e.sortedGoodsObj.dataIsNull=1,e.sortedGoodsObj.nullMsg="没有此类商品哦O(∩_∩)O~"):(e.sortedGoodsObj.dataIsNull=0,e.sortedGoodsObj.nullMsg="")):b.moredata=!1,b.goodsDatas=o.goodsData),e.$broadcast("scroll.refreshComplete")},error:function(e){}};s.getData("/api/getGoods",O).then(o.success,o.error)}function c(){return console.log("page0->",h),O.page=h,1==h?void setTimeout(function(){var o={success:function(o){0==o.status&&(e.sortedGoodsObj.cateData=o.cateData,console.log(o),o.goodsData.length<perPageCount?(0==o.goodsData.length&&0==b.goodsDatas.length?(b.dataIsNull=!0,e.sortedGoodsObj.nullMsg="没有此类商品哦O(∩_∩)O~",e.sortedGoodsObj.dataIsNull=1):(e.sortedGoodsObj.dataIsNull=0,e.sortedGoodsObj.nullMsg="",b.dataIsNull=!1),b.moredata=!0):b.moredata=!1,b.goodsDatas=[],b.goodsDatas=b.goodsDatas.concat(o.goodsData),h++),e.$broadcast("scroll.infiniteScrollComplete")},error:function(e){}};console.log("page->",O.page),s.getData("/api/getGoods",O).then(o.success,o.error)},300):(console.log(">>>>>>"),console.log(O),O.page=h,s.getData("/api/getGoods",O).then(function(o){console.log(o),0==o.status&&(o.goodsData.length<perPageCount?b.moredata=!0:b.moredata=!1,b.goodsDatas=b.goodsDatas.concat(o.goodsData),h++),e.$broadcast("scroll.infiniteScrollComplete")},function(e){}),void 0)}function g(e){t.go("tabs.igDetail",{is_integral:1,goods_id:e.goods_id}),r.nextDirection("forward")}function p(o){void 0==o&&(o=""),O["cate_id[]"]=[],O.startPrice="",O.endPrice="",O.searchStr=o,e.sideMenuObj.isSearch=!0,b.goodsDatas=[],d()}function u(e,o){}function m(e){b.moredata=!1,h=1,e.page=h,n.scrollTop(),n.resize()}function f(o){function t(e){b.goodsDatas=[],O.sortKey=e,O.sort="asc",m(O)}function s(e){b.goodsDatas=[],O.sortKey=e,O.sort="desc",m(O)}e.loadingShow(),e.loadingOrPopTipsHide();var r=angular.element(o.currentTarget).children(),n=angular.element(o.target);switch(b.noneOfMoreData=!1,b.noneMsg="",b.moredata=!1,n.text()){case"综合":e.sortedGoodsObj.dataIsNull=0,s("coll");break;case"销量":e.sortedGoodsObj.dataIsNull=0,s("hot");break;case"价格":e.sortedGoodsObj.dataIsNull=0,n.hasClass("active")?(e.sortedGoodsObj.priceTapNums++,e.sortedGoodsObj.priceTapNums>0&&(e.sortedGoodsObj.isPriceHeigh=!e.sortedGoodsObj.isPriceHeigh,e.sortedGoodsObj.isPriceHeigh?(t("integral"),e.sortedGoodsObj.arrowImg="images/shangArrow.png"):(s("integral"),e.sortedGoodsObj.arrowImg="images/xiaoArrow.png"))):(e.sortedGoodsObj.priceTapNums=0,e.sortedGoodsObj.isPriceHeigh?(t("integral"),e.sortedGoodsObj.arrowImg="images/shangArrow.png"):(s("integral"),e.sortedGoodsObj.arrowImg="images/xiaoArrow.png"));break;case"筛选":e.sideMenuObj.sideMenuOnOpened(0,1,e.sortedGoodsObj.cateData),a.toggleRight()}n.toString().indexOf("Image")!=-1?"筛选"!=n.parent().text()&&(r.removeClass("active"),n.parent().addClass("active")):"筛选"==n.text()||(r.removeClass("active"),n.addClass("active"))}var b=e.sortedGoodsObj={priceTapNums:0,hotTapNums:0,isPriceHeigh:!0,moredata:!1,viewTitle:"",dataIsNull:0,nullMsg:"",cateData:null,goodsDatas:[],noneOfMoreData:!1,goDetail:g,convertNow:u,sortAction:f,goSearch:p,doRefresh:d,loadMore:c,currentPage:1,hotImgeName:"xiaoArrow.png",arrowImg:"images/shangArrow.png",noneMsg:"",dragup:l};e.$on("$ionicView.beforeEnter",function(){i.hideTabs=!0}),e.sortedGoodsObj.viewTitle=o.sortname;var h=1,O={integral:1,total:perPageCount,page:h,searchStr:o.searchStr,"cate_id[]":o.cate_id.split(",")};e.$on("sureSorted",function(o,t){e.searchStr="",console.log(t),b.currentPage=1,O["cate_id[]"]=[],O["cate_id[]"]=t.sortedSelectedIDS,O.startPrice=t.minPrice,O.endPrice=t.maxPrice,O.searchStr="",b.goodsDatas=[],b.noneOfMoreData=!1,console.log(">>>>>>>>"),console.log(O),setTimeout(function(){d()},200)}),e.$on("$ionicView.enter",function(){i.hideTabs=!0,e.sideMenuObj.sideMenuClose();var o=navigator.userAgent,t=o.indexOf("Android")>-1||o.indexOf("Adr")>-1;if(t){var s=document.body.clientHeight,r=document.body.clientHeight;document.getElementsByClassName("tabs")[0];window.onresize=function(){if(document.body.clientHeight<s&&r>document.body.clientHeight&&(r=document.body.clientHeight,i.hideTabs=!0),document.body.clientHeight>r&&a.isOpen()){var e=document.querySelector(".minPriceInput"),o=document.querySelector(".maxPriceInput");e.blur(),o.blur()}}}})}]),angular.module("cftApp.tabs",[]).controller("tabsController",["$scope","$rootScope","$ionicViewSwitcher","$location","$state","$ionicLoading","$ionicGesture","$document","HttpFactory","WebIMWidget","RongCustomerService","CftStore","$http",function(e,o,t,a,s,r,n,i,l,d,c,g,p){function u(o,t){console.log(t.target),t.target.placeholder="",e.sideMenuObj.tabIsHide=1}function m(o,t){e.sideMenuObj.tabIsHide=0,"min"==o?t.target.placeholder="最低价":t.target.placeholder="最高价"}function f(t){o.hideTabs=!0,_.isSearch=!0,_.oneclass="",_.secondClass=[],g.setObject("selectedObj",T),0===_.is_integral?e.$broadcast("home_sortedView",""):e.$broadcast("integral_sortedView","")}function b(e,o){T.oneclass=o,$=[],$.push(o),O(o)}function h(t,a){_.isSearch=!1,T.secondClass=[],T.secondClass.push(a.id),$=[],$.push(a.id),console.log("首页选中二级标题"),console.log(T.secondClass),g.setObject("selectedObj",T),console.log($),o.hideTabs=!0,0===_.is_integral?e.$broadcast("home_sortedView",$):e.$broadcast("integral_sortedView",$)}function O(o){if(console.log("选中一级"),console.log(o),!o)return void(e.sideMenuObj.isShow=!1);e.sideMenuObj.isShow=!0,e.sideMenuObj.menuSecondClasses=_.sortedSecondClassObj[o].childData;var t=angular.element(document.querySelector("#secondClasses")).children();return t.removeClass("active"),null==_.sortedSecondClassObj[o].childData?void e.popTipsShow("暂无二级分类"):void(_.headTitle="二级分类")}function S(o,t,a){if(setTimeout(function(){e.sideMenuObj.isOpen=!0},500),_.is_allGoods=t,_.is_integral=o,console.log("cateData"),console.log(a),console.log(_.sortedSecondClassObj),"{}"!=JSON.stringify(_.sortedSecondClassObj)?(console.log("....."),_.sortedClassKeys=Object.keys(_.sortedSecondClassObj)):(_.sortedSecondClassObj=a,_.sortedClassKeys=Object.keys(a)),console.log(_.sortedClassKeys),t){var s=angular.element(document.querySelector("#secondClasses")).children();s.removeClass("active"),_.isSearch?(T.oneclass="",T.secondClass=[],T.minPrice="",T.maxPrice="",g.setObject("selectedObj",T)):(T=g.getObject("selectedObj"),console.log("这是全部商品打开 侧边栏对象"),console.log(T)),_.filterObj.minPrice=T.minPrice,_.filterObj.maxPrice=T.maxPrice,O(T.oneclass),setTimeout(function(){O(T.oneclass);var e=angular.element(document.getElementById("sortedFirstClass")).children();e.removeClass("active"),angular.forEach(e,function(e,o){var t=angular.element(e);t.hasClass(T.oneclass)&&t.addClass("active")});var o=angular.element(document.getElementById("secondClasses")).children();o.removeClass("active");for(var t in T.secondClass)T.secondClass.hasOwnProperty(t)&&angular.forEach(o,function(e,o){var a=angular.element(e);a.hasClass(T.secondClass[Number(t)])&&a.addClass("active")})},10)}else _.headTitle="一级分类"}function D(){e.sideMenuObj.isOpen&&(e.sideMenuObj.isOpen=!1)}function v(e,o){T.secondClass=[];var t=angular.element(document.getElementById("sortedFirstClass")).children();t.removeClass("active");var a=angular.element(e.target);a.addClass("active"),O(o),T.oneclass=o}function y(e,o){var t=angular.element(e.target);t.hasClass("active")?(t.removeClass("active"),T.secondClass.cftRemove(o.id)):(t.addClass("active"),T.secondClass.push(o.id))}function C(){T=g.getObject("selectedObj");var e=angular.element(document.querySelector("#secondClasses")).children();e.removeClass("active")}function j(){T.minPrice=_.filterObj.minPrice,T.maxPrice=_.filterObj.maxPrice,_.isSearch=!1,g.setObject("selectedObj",T),$=[],$=T.secondClass.length>0?T.secondClass:T.oneclass,_.filterObj.sortedSelectedIDS=$,console.log("???????"),console.log(_.filterObj),e.$broadcast("sureSorted",_.filterObj)}var w=!1,_=e.sideMenuObj={is_integral:0,is_allGoods:0,headTitle:"一级分类",menuSecondClasses:[],sortedClassKeys:[],filterObj:{sortedSelectedIDS:[],minPrice:"",maxPrice:""},isSearch:!1,isOpen:!1,isShow:!1,sortedSecondClassObj:{},selectAll:f,selectHomeFirstClass:b,tapedHomeSecondClass:h,sideMenuOnOpened:S,selectFiterFirstClass:v,tapedSortedSecondClass:y,cancelOption:C,sureOption:j,sideMenuClose:D,priceOnFocus:u,priceOnBlur:m,tabIsHide:0},T={oneclass:"2",secondClass:[],minPrice:"",maxPrice:""};e.user_Car_Num="";var A="",$=[];localStorage.headimgurl="",localStorage.userName="",localStorage.creditNum="",l.getData("/api/getSign",{url:location.href.split("#")[0]}).then(function(e){wx.config({debug:!1,appId:e.appId,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","openLocation","getLocation","scanQRCode","chooseWXPay","openProductSpecificView","closeWindow","hideMenuItems"]})}),wx.ready(function(){console.log("微信准备完毕"),wx.hideMenuItems({menuList:["menuItem:share:email","menuItem:openWithSafari","menuItem:share:qq","menuItem:share:QZone","menuItem:copyUrl","menuItem:exposeArticle","menuItem:setFont","menuItem:readMode"]});var o=g.get("phpCookies"),t={PHPSESSID:o};console.log(t),""!=o&&"undefined"!=o||(t={}),l.getData("/api/memberInfo").then(function(o){1==o.status&&(e.popTipsShow("未登录，请重新进入公众号"),s.go("tabs.homePage")),user_car_num=parseInt(o.cartnum),localStorage.headimgurl=o.headimgurl,localStorage.userName=o.nickname,localStorage.creditNum=o.integral,e.$broadcast("userInfo",{headimgurl:o.headimgurl,userName:o.nickname,creditNum:o.integral}),wx.onMenuShareAppMessage({title:"SUNNY SHU官方商城",desc:"有机生活共享平台，欢迎您的光临。",link:"http://www.sunnyshu.cn/sunny/wap/api/memberlogin?isp=4&c_user="+o.userid,imgUrl:"http://www.sunnyshu.cn/sunny/wap/images/logo_share.png",type:"link",dataUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareTimeline({title:"SUNNY SHU官方商城",link:"http://www.sunnyshu.cn/sunny/wap/api/memberlogin?isp=4&c_user="+o.userid,imgUrl:"http://www.sunnyshu.cn/sunny/wap/images/logo_share.png",success:function(){},cancel:function(){}})},function(e){})}),wx.error(function(e){}),o.$on("$routeChangeStart",function(e,o,t){console.log(o)}),o.$on("$stateChangeSuccess",function(e,o,t,a){var s=angular.element(document.getElementById("self_kf_btn"));"tabs.personal"!=o.name&&"tabs.myOrder"!=o.name&&"tabs.collectionPager"!=o.name&&"tabs.shoppingCart"!=o.name&&"tabs.totalScore"!=o.name&&"tabs.receiptAddress"!=o.name&&"tabs.payRecord"!=o.name&&"tabs.scanCodePayment"!=o.name&&"tabs.evaluatePage"!=o.name&&"tabs.confirmOrder_personal"!=o.name&&"tabs.orderDetail"!=o.name&&"tabs.confirmOrder_personal"!=o.name&&"tabs.confirmOrder_personal"!=o.name&&"tabs.confirmOrder_personal"!=o.name&&w?(s.css("display",""),"tabs.napaStores"==o.name?(A="扫码",s.css("background","url('images/paymoney.png') no-repeat center/100%")):(A="",s.css("background","url('images/service1.png') no-repeat center/100%"))):s.css("display","none");var r=function(e){document.getElementsByTagName("body")[0];document.title=e;var o=document.createElement("iframe");o.setAttribute("src","images/empty.png"),o.addEventListener("load",function(){setTimeout(function(){document.body.removeChild(o)})}),document.body.appendChild(o)};switch(o.name){case"tabs.homePage":r("SUNNY SHU官方商城");break;case"tabs.integralStore":r("积分商城");break;case"tabs.napaStores":r("加盟店");break;case"tabs.personal":r("个人中心");break;case"tabs.goodsDetail":r(g.get("goodsName"));break;case"tabs.goodsDetail_collection":r(g.get("goodsName"));break;case"tabs.goodsDetail_orderDetail":r(g.get("goodsName"));break;case"tabs.igDetail_personal":r(g.get("goodsName"));break;case"tabs.shoppingCart":r("购物车");break;case"tabs.shoppingCart_fromDetail":r("购物车");break;case"tabs.igDetail":r(g.get("goodsName"));break;case"tabs.receiptAddress_home":r("管理收货地址");break;case"tabs.receiptAddress":r("管理收货地址");break;case"tabs.receiptAddress_IG":r("管理收货地址");break;case"tabs.collectionPager":r("我的收藏");break;case"tabs.myOrder":r("我的订单");break;case"tabs.totalScore":r("积分查询");break;case"tabs.payRecord":r("交易记录");break;case"tabs.confirmOrder":r("确认订单");break;case"tabs.confirmOrder_personal":r("确认订单");break;case"tabs.confirmOrder_IG":r("确认订单");break;case"tabs.orderDetail":r("订单详情");break;case"tabs.sortedGoods":r("所有商品")}}),e.$on("detailEvaSucc",function(o){console.log("评价是否成功"),console.log(o),"success"==o&&e.$broadcast("toDetailSuccess","success")}),e.clickHome=function(){s.go("tabs.integralStore")},e.clickPersonal=function(){s.go("tabs.personal")},e.popTipsShow=function(e){r.show({template:e,duration:1300,noBackdrop:!0}).then(function(){})},e.loadingShow=function(e){e=e?e:"加载中...",r.show({template:'<ion-spinner class="selfSpinner">'+e+"</ion-spinner>",noBackdrop:!0})},e.loadingOrPopTipsHide=function(){r.hide()},l.getData("/rongyun/index").then(function(e){c.init({appkey:e.appkey,token:e.token,customerServiceId:e.customerServiceId,position:c.Position.right,reminder:" ",style:{width:document.body.clientWidth,height:document.body.clientHeight,displayMinButton:!1,positionFixed:!0},onSuccess:function(){w=!0;var e=angular.element(document.getElementsByTagName("rong-widget"));e.css("display","");var o=document.getElementById("Messages");console.log("融云聊天内容"),console.log(o),o.addEventListener("touchstart",function(){angular.element(o).css("overflow","scroll !important"),console.log("摸我干啥")},!1);var t=angular.element(document.getElementById("rong-widget-minbtn"));t.css("display","none");var r=angular.element(document.getElementById("rong-sendBtn"));r.css("backgroundColor","#E60012");var l=angular.element(document.getElementById("header").childNodes[1].childNodes[1]);l.on("click",function(){console.log("hello,word")});var d=angular.element(document.getElementById("self_kf_btn"));"/tabs/personal"!=a.url()&&(d.css("display",""),s.reload());var c=parseFloat(d.css("bottom").split("px")[0]);i.on("touchmove",function(e){e.cancelable&&(e.defaultPrevented||(e.preventDefault(),e.stopPropagation()))}),n.on("touch",function(e){c=parseFloat(d.css("bottom").split("px")[0]),console.log(".......")},d),n.on("dragup",function(e){document.body.clientHeight-parseFloat(d.css("bottom").split("px")[0])<30?d.css("bottom",document.body.clientHeight-30+"px"):d.css("bottom",c-e.gesture.deltaY+"px")},d),n.on("dragdown",function(e){parseFloat(d.css("bottom").split("px")[0])<10?d.css("bottom","10px"):d.css("bottom",c-e.gesture.deltaY+"px")},d)},onError:function(e){}})}),e.open_KF_scanQRCode=function(){"扫码"==A?wx.scanQRCode({needResult:0,scanType:["qrCode","barCode"],success:function(e){e.resultStr}}):e.showbtn()}}]),angular.module("cftApp.totalScore",[]).config(["$stateProvider",function(e){e.state("tabs.totalScore",{url:"/totalScore",views:{"tabs-personal":{templateUrl:"totalScore.html",controller:"totalScoreController"}}})}]).controller("totalScoreController",["$scope","$rootScope","$state","$ionicViewSwitcher","HttpFactory","CftStore",function(e,o,t,a,s,r){function n(){console.log("my integral drag up"),!e.scoreObj.moredata&&e.scoreObj.scoreListDatas.length>0&&(e.scoreObj.noMoreData=1,e.scoreObj.noMoreDataMsg="没有更多积分记录")}function i(){return 0==d?void e.$broadcast("scroll.refreshComplete"):(c=1,e.scoreObj.noMoreData=0,e.scoreObj.noMoreDataMsg="",void s.getData("/api/uintegral",{sessid:SESSID,page:c,total:perPageCount},"GET").then(function(o){0==o.status&&(c=2,0==o.integralData.length&&0==e.scoreObj.scoreListDatas.length?(e.scoreObj.msgsIsNull=1,e.scoreObj.emptyLogMsg="您还没积分记录O(∩_∩)O~"):(e.scoreObj.msgsIsNull=0,e.scoreObj.emptyLogMsg=""),o.integralData.length>=perPageCount?e.scoreObj.moredata=!0:e.scoreObj.moredata=!1,e.scoreObj.scoreListDatas=o.integralData),console.log(o),e.$broadcast("scroll.refreshComplete"),console.log(e.scoreObj.scoreListDatas)},function(e){}))}function l(){console.log(c),s.getData("/api/uintegral",{sessid:SESSID,page:c,total:perPageCount},"GET").then(function(o){d=1,0==o.status&&(c++,o.integralData.length<perPageCount?(e.scoreObj.moredata=!1,0==o.integralData.length&&0==e.scoreObj.scoreListDatas.length?(e.scoreObj.msgsIsNull=1,e.scoreObj.emptyLogMsg="您还没积分记录O(∩_∩)O~"):(e.scoreObj.msgsIsNull=0,e.scoreObj.emptyLogMsg="")):e.scoreObj.moredata=!0,e.scoreObj.scoreListDatas=e.scoreObj.scoreListDatas.concat(o.integralData)),console.log(o),e.$broadcast("scroll.infiniteScrollComplete"),console.log(e.scoreObj.scoreListDatas)},function(e){})}e.goExchange=function(e){t.go("tabs.integralStore")},e.$on("$ionicView.beforeEnter",function(){o.hideTabs=!0}),e.scoreObj={scoreListDatas:[],moredata:!0,loadMore:l,doRefresh:i,msgsIsNull:0,emptyLogMsg:1,dragup:n,noMoreData:0,noMoreDataMsg:"",creditNum:0};var d=0;e.scoreObj.creditNum=r.get("creditNum");var c=1}]),angular.module("cftApp.factories",[]).factory("HttpFactory",["$http","$q",function(e,o){return{getData:function(t,a,s){if(t){t=ROOT_URL+t;var r=o.defer();return s=s?s:"GET",a=a?a:{},e({url:t,method:s,params:a,timeout:2e4}).then(function(e){e=e.data,r.resolve(e)},function(e){r.reject(e)}),r.promise}}}}]).value("MainData",{shopping_car_goodsArray:null,userSelectAddress:null,selectedOrder_datas:null,isFromPersonToReceiptAddress:!1}),angular.module("ctfApp.keyboardHandler",[]).directive("keyboardHandler",["$window","$rootScope",function(e,o){return{restrict:"A",link:function(t,a,s){angular.element(e).bind("native.keyboardshow",function(){console.log(">>>.."),o.hideTabs=!0}),angular.element(e).bind("native.keyboardhide",function(){o.hideTabs=!1})}}}]),void function(e){function o(e,o){var t,a=ROOT_URL+e;if("[object Object]"===Object.prototype.toString.call(o)&&null!=o){var s=0;for(t in o)o.hasOwnProperty(t)&&(a=0==s?a+"?"+t+"="+o[t]:a+"&"+t+"="+o[t],s++);return console.log(a),a}return"string"==typeof o&&0==o.indexOf("?")?a+o:a}e.cftRequestUrl=o}(window),angular.module("ctfApp.searchBar",[]).directive("ctfSearchBar",function(){return{restrict:"EA",replace:!0,scope:{integral:"@",isSorted:"@",searchDatas:"="},template:'<div class="ctf-search-view"><label class="item item-input"><input class="cft-textField" ng-model="searchValue" type="text" placeholder="例：大闸蟹"></label><button class="ctf-search-btn" style="height: 1.6rem" ng-click="goSearch(searchValue)"></button></div>',controller:["$scope","$state","$ionicViewSwitcher","$rootScope","HttpFactory",function(e,o,t,a,s){}],link:function(e,o,t){}}}),angular.module("cftApp.slideBox",[]).directive("mgSlideBox",[function(){return{restrict:"E",scope:{sourceData:"="},template:'<div class="topCarousel"><ion-slide-box delegate-handle="topCarouselSlideBox" auto-play="true" does-continue="true"  slide-interval="3000" show-pager="true" on-drag="drag($event)"  ng-if="isShowSlideBox"><ion-slide ng-if="sourceData.ishome == 0 || sourceData.ishome == 1" ng-repeat="ads in sourceData.bannerData track by $index" ng-click="goToDetailView(ads)"><div ng-if="sourceData.ishome == 0 || sourceData.ishome == 1" style="background: url({{iconRootUrl + ads.image_url}}) no-repeat center; width: 100%;background-size: 100% 100%;" class="topCarouselImg"></div></ion-slide><ion-slide ng-if="sourceData.ishome == 2" ng-repeat="imgUrl in sourceData.bannerData track by $index"><div style="background: url(http://www.sunnyshu.cn{{imgUrl}}) no-repeat center;background-size: 100% 100%;width: 100%;padding-bottom: 61%" class="detailTopCarouselImg"></div></ion-slide></ion-slide-box><p></p></div>',controller:["$scope","$element","$ionicSlideBoxDelegate","$ionicScrollDelegate","$state","$ionicViewSwitcher","$rootScope","$ionicLoading","CftStore",function(e,o,t,a,s,r,n,i,l){e.iconRootUrl=IconROOT_URL,e.goToDetailView=function(o){if(0==e.sourceData.ishome){if(!o.param)return void i.show({template:"该商品不存在!",duration:1300,noBackdrop:!0}).then(function(){});l.set("goodsName",o.name),s.go("tabs.goodsDetail",{goods_id:o.param})}else{if(!o.param)return void i.show({template:"该商品不存在!",duration:1300,noBackdrop:!0}).then(function(){});l.set("goodsName",o.name),s.go("tabs.igDetail",{goods_id:o.param})}r.nextDirection("forward")},e.isShowSlideBox=!1,e.$watch("sourceData.bannerData",function(o,a){o&&o.length&&(e.isShowSlideBox=!0,t.update(),t.loop(!0))})}],replace:!0,link:function(e,o,t){}}}]),angular.module("cftApp.storageFactory",[]).factory("CftStore",["$window",function(e){return{set:function(o,t){e.localStorage[o]=t},get:function(o,t){return e.localStorage[o]||t},setObject:function(o,t){e.localStorage[o]=JSON.stringify(t)},getObject:function(o){return e.localStorage[o]?JSON.parse(e.localStorage[o]):null}}}]),void function(e){Array.prototype.cftRemove=function(e){var o=this.indexOf(e);o>-1&&this.splice(o,1)}}(window);